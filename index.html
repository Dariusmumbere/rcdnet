<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NGO Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src = "fundraising.js"></script>
    <script src = "donations.js"></script>
    <script src = "hrr.js"></script>
    <script src="donations-management.js"></script>
    <script src="folders.js"></script>
    <script src="activities.js"></script>
    <script src="delete-donation.js"></script>
    <script src="donor-profiles.js"></script>
    <script src="fileManager.js"></script>
    
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --sidebar-width: 250px;
            --sidebar-collapsed-width: 80px;
            --header-height: 70px;
            --transition-speed: 0.3s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            display: flex;
            min-height: 100vh;
            transition: margin-left var(--transition-speed);
        }

        /* Header Styles */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo img {
            height: 40px;
        }

        .logo h1 {
            font-size: 1.2rem;
            color: var(--dark-color);
            font-weight: 700;
            white-space: nowrap;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-profile img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .user-role {
            font-size: 0.8rem;
            color: #777;
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            top: var(--header-height);
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - var(--header-height));
            background-color: var(--dark-color);
            color: white;
            transition: width var(--transition-speed);
            overflow: hidden;
            z-index: 99;
        }

        .sidebar.collapsed {
            width: var(--sidebar-collapsed-width);
        }

        .sidebar-menu {
            list-style: none;
            padding: 20px 0;
        }

        .sidebar-menu li {
            position: relative;
        }

        .sidebar-menu li a {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: var(--light-color);
            text-decoration: none;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .sidebar-menu li a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sidebar-menu li a.active {
            background-color: var(--primary-color);
        }

        .sidebar-menu li a i {
            font-size: 1.2rem;
            margin-right: 15px;
            min-width: 24px;
            text-align: center;
        }

        .sidebar-menu li a span {
            transition: opacity var(--transition-speed);
        }

        .sidebar.collapsed .sidebar-menu li a span {
            opacity: 0;
            width: 0;
            display: none;
        }

        .sidebar.collapsed .sidebar-menu li a {
            justify-content: center;
            padding: 15px 0;
        }

        .sidebar.collapsed .sidebar-menu li a i {
            margin-right: 0;
        }

        .submenu {
            list-style: none;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background-color: rgba(0, 0, 0, 0.2);
        }

        .submenu.show {
            max-height: 500px;
        }

        .submenu li a {
            padding-left: 50px !important;
            font-size: 0.9rem;
        }

        .sidebar.collapsed .submenu li a {
            padding-left: 0 !important;
            justify-content: center;
        }

        .menu-toggle {
            background: none;
            border: none;
            color: var(--dark-color);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 10px;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            margin-top: var(--header-height);
            padding: 30px;
            transition: margin-left var(--transition-speed);
        }

        .sidebar.collapsed ~ .main-content {
            margin-left: var(--sidebar-collapsed-width);
        }

        .page-title {
            font-size: 1.8rem;
            color: var(--dark-color);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Dashboard Styles */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-card .stat-title {
            font-size: 0.9rem;
            color: #777;
            margin-bottom: 10px;
        }

        .stat-card .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stat-card .stat-change {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }

        .stat-card .stat-change.positive {
            color: var(--success-color);
        }

        .stat-card .stat-change.negative {
            color: var(--accent-color);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        .dashboard-section {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .section-link {
            color: var(--primary-color);
            font-size: 0.9rem;
            text-decoration: none;
        }

        .recent-activities {
            list-style: none;
        }

        .activity-item {
            display: flex;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: var(--primary-color);
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .activity-time {
            font-size: 0.8rem;
            color: #777;
        }

        .project-progress {
            margin-top: 20px;
        }

        .project-item {
            margin-bottom: 15px;
        }

        .project-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .project-name {
            font-weight: 600;
        }

        .project-percent {
            color: var(--primary-color);
        }

        .progress-bar {
            height: 8px;
            background-color: #eee;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 4px;
        }

        .donation-chart {
            height: 250px;
            margin-top: 20px;
        }

        /* Enhanced File Manager Styles */
        .file-manager-container {
            display: none;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .file-manager-container.show {
            display: block;
        }

        .file-manager-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .file-manager-actions {
            display: flex;
            gap: 10px;
        }

        .file-manager-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .file-manager-btn:hover {
            background-color: var(--secondary-color);
        }

        .file-manager-btn.secondary {
            background-color: #f0f0f0;
            color: var(--dark-color);
        }

        .file-manager-btn.secondary:hover {
            background-color: #e0e0e0;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .breadcrumb-item {
            color: var(--primary-color);
            cursor: pointer;
        }

        .breadcrumb-item:hover {
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #777;
        }

        .file-manager-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
        }

        .file-item, .folder-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .file-item:hover, .folder-item:hover {
            background-color: #f5f5f5;
        }

        .file-icon, .folder-icon {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            color: var(--primary-color);
            font-size: 2rem;
        }

        .folder-icon {
            color: var(--warning-color);
        }

        .file-name, .folder-name {
            text-align: center;
            font-size: 0.8rem;
            font-weight: 500;
            word-break: break-word;
            width: 100%;
        }

        .file-actions-menu {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .file-item:hover .file-actions-menu,
        .folder-item:hover .file-actions-menu {
            opacity: 1;
        }

        .file-actions-dropdown {
            position: absolute;
            top: 30px;
            right: 0;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 10;
            display: none;
            min-width: 150px;
        }

        .file-actions-dropdown.show {
            display: block;
        }

        .file-action-item {
            padding: 8px 15px;
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-action-item:hover {
            background-color: #f5f5f5;
        }

        .file-action-item i {
            width: 18px;
            text-align: center;
        }

        .file-preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .file-preview-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .file-preview-content {
            background-color: white;
            border-radius: 10px;
            width: 80%;
            max-width: 900px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        .file-preview-header {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-preview-body {
            flex: 1;
            padding: 20px;
            overflow: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .file-preview-iframe {
            width: 100%;
            height: 60vh;
            border: none;
            background-color: #f9f9f9;
        }

        .file-preview-image {
            max-width: 100%;
            max-height: 60vh;
            object-fit: contain;
        }

        .file-preview-actions {
            padding: 15px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .folder-create-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .folder-create-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .folder-create-content {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            padding: 20px;
        }

        .folder-create-header {
            margin-bottom: 20px;
        }

        .folder-create-body {
            margin-bottom: 20px;
        }

        .folder-create-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .folder-create-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Upload Modal Styles */
        .upload-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .upload-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .upload-content {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            padding: 20px;
        }

        .upload-header {
            margin-bottom: 20px;
        }

        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: var(--primary-color);
            background-color: rgba(52, 152, 219, 0.05);
        }

        .upload-area i {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .upload-area p {
            margin-bottom: 10px;
            color: #777;
        }

        .upload-area .browse-btn {
            color: var(--primary-color);
            font-weight: 600;
            cursor: pointer;
        }

        #fileUploadInput {
            display: none;
        }

        .upload-progress {
            margin-top: 15px;
            display: none;
        }

        .progress-bar-container {
            width: 100%;
            height: 10px;
            background-color: #eee;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s;
        }

        .upload-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        /* Responsive adjustments */
        @media (max-width: 992px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .logo h1 {
                font-size: 1rem;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform var(--transition-speed);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .sidebar.collapsed {
                width: var(--sidebar-width);
            }

            .main-content {
                margin-left: 0;
            }
            
            .logo h1 {
                display: none;
            }
        }

            .file-manager-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
            
            .file-preview-content {
                width: 95%;
                height: 90vh;
            }

            .file-manager-actions {
                flex-direction: column;
                align-items: flex-end;
            }
        }
                /* Donations Page Styles */
        .donations-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .donations-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            color: #777;
            transition: all 0.3s;
        }

        .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-btn:hover:not(.active) {
            color: var(--dark-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .table-responsive {
            overflow-x: auto;
        }

        .donations-table {
            width: 100%;
            border-collapse: collapse;
        }

        .donations-table th, 
        .donations-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .donations-table th {
            background-color: #f9f9f9;
            font-weight: 600;
        }

        .donations-table tr:hover {
            background-color: #f5f5f5;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-badge.completed {
            background-color: #e6f7ee;
            color: var(--success-color);
        }

        .status-badge.pending {
            background-color: #fff5e6;
            color: var(--warning-color);
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            margin: 0 3px;
            color: #777;
            transition: color 0.2s;
        }

        .action-btn:hover {
            color: var(--primary-color);
        }

        .action-btn.delete-btn:hover {
            color: var(--accent-color);
        }

        .receipts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .receipt-card {
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .receipt-header {
            background-color: #f9f9f9;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
        }

        .receipt-header h3 {
            margin: 0;
            font-size: 1.1rem;
        }

        .receipt-date {
            color: #777;
            font-size: 0.9rem;
        }

        .receipt-body {
            padding: 15px;
        }

        .receipt-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .receipt-row:last-child {
            margin-bottom: 0;
        }

        .receipt-label {
            font-weight: 600;
            color: #555;
        }

        .receipt-value {
            text-align: right;
        }

        .receipt-actions {
            padding: 15px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
        }

        .donor-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .donor-card {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            gap: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .donor-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary-color);
            flex-shrink: 0;
        }

        .donor-info {
            flex: 1;
        }

        .donor-name {
            margin: 0 0 10px 0;
            font-size: 1.2rem;
        }

        .donor-contact {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: #555;
        }

        .donor-contact i {
            width: 20px;
            text-align: center;
        }

        .donor-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stat-item {
            font-size: 0.9rem;
        }

        .stat-label {
            display: block;
            color: #777;
            font-size: 0.8rem;
        }

        .stat-value {
            font-weight: 600;
        }

        .donor-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            justify-content: center;
        }

        /* Donation Modal Styles */
        .donation-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .donation-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #777;
        }

        .modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-group textarea {
            resize: vertical;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        /* Director Dashboard Bank Cards */
    .bank-cards-container {
        display: flex;
        gap: 20px;
        margin-bottom: 30px;
        flex-wrap: wrap;
    }
    
    .bank-card {
        flex: 1;
        min-width: 200px;
        background: linear-gradient(135deg, #3498db, #2980b9);
        border-radius: 12px;
        padding: 20px;
        color: white;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: hidden;
    }
    
    .main-bank-card {
        background: linear-gradient(135deg, #2c3e50, #34495e);
        min-width: 280px;
    }
    
    .bank-card::before {
        content: '';
        position: absolute;
        top: -50px;
        right: -50px;
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
    }
    
    .bank-card::after {
        content: '';
        position: absolute;
        bottom: -30px;
        right: -30px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
    }
    
    .bank-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .bank-card-title {
        font-size: 1rem;
        font-weight: 500;
        opacity: 0.8;
    }
    
    .bank-card-logo {
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .bank-card-balance {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 5px;
    }
    
    .bank-card-number {
        font-family: 'Courier New', monospace;
        letter-spacing: 1px;
        font-size: 0.9rem;
        margin-bottom: 20px;
        opacity: 0.8;
    }
    
    .bank-card-footer {
        display: flex;
        justify-content: space-between;
        font-size: 0.8rem;
    }
    
    .bank-card-footer-item {
        display: flex;
        flex-direction: column;
    }
    
    .bank-card-footer-label {
        opacity: 0.7;
        margin-bottom: 3px;
    }
    
    .bank-card-footer-value {
        font-weight: 600;
    }
    
    /* Program area cards */
    .program-card-1 {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
    }
    
    .program-card-2 {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
    }
    
    .program-card-3 {
        background: linear-gradient(135deg, #f39c12, #d35400);
    }
    
    .program-card-4 {
        background: linear-gradient(135deg, #9b59b6, #8e44ad);
    }
    
    .director-dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
        /* Add to your existing CSS */
.donor-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s;
}

.donor-modal.show {
    opacity: 1;
    visibility: visible;
}

.donor-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    padding: 15px;
    background-color: #f9f9f9;
    border-radius: 8px;
    margin-bottom: 20px;
}

.stat-item {
    font-size: 0.9rem;
}

.stat-label {
    display: block;
    color: #777;
    font-size: 0.8rem;
}

.stat-value {
    font-weight: 600;
}
        .validation-error {
    color: var(--accent-color);
    font-size: 0.8rem;
    margin-top: 5px;
    display: none;
}

.form-group input:invalid, 
.form-group select:invalid, 
.form-group textarea:invalid {
    border-color: var(--accent-color);
}
        .delete-btn {
    background-color: var(--accent-color);
    color: white;
}

.delete-btn:hover {
    background-color: #c0392b;
}
        /* Add these styles to your existing CSS */

/* Donation History PDF Styles */
.donation-history-container {
    background-color: white;
    border-radius: 8px;
    padding: 25px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    margin-bottom: 30px;
}

.donation-history-header {
    text-align: center;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 1px solid #eee;
}

.donation-history-title {
    font-size: 1.5rem;
    color: var(--primary-color);
    margin-bottom: 10px;
}

.donor-details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 15px;
    margin-bottom: 25px;
}

.detail-box {
    background-color: #f9f9f9;
    border-radius: 6px;
    padding: 12px 15px;
    border-left: 3px solid var(--primary-color);
}

.detail-label {
    font-size: 0.85rem;
    color: #666;
    margin-bottom: 5px;
}

.detail-value {
    font-weight: 500;
    font-size: 1rem;
}

.modern-table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
}

.modern-table thead th {
    text-align: left;
    padding: 12px 15px;
    color: #555;
    font-weight: 600;
    background-color: #f8f9fa;
}

.modern-table tbody td {
    padding: 12px 15px;
    border-bottom: 1px solid #f0f0f0;
}

.modern-table tbody tr:last-child td {
    border-bottom: none;
}

.modern-table tbody tr:hover {
    background-color: #f8f9fa;
}

.amount-cell {
    text-align: center;
    font-family: 'Courier New', monospace;
    font-weight: bold; 
}

.total-row {
    font-weight: 600;
    background-color: #f1f8fe;
}

.download-history-btn {
    margin-top: 20px;
    display: flex;
    justify-content: flex-end;
}
        /* Donation History Styles */
.donation-history-container {
    background-color: white;
    border-radius: 8px;
    padding: 25px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    margin-bottom: 30px;
}

.donation-history-header {
    text-align: center;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.donation-history-title {
    font-size: 1.5rem;
    color: var(--primary-color);
    margin-bottom: 10px;
}

.total-amount {
    font-weight: 600;
    color: var(--dark-color);
    background-color: #f1f8fe;
    padding: 8px 15px;
    border-radius: 20px;
}

.donor-details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 15px;
    margin-bottom: 25px;
}

.detail-box {
    background-color: #f9f9f9;
    border-radius: 6px;
    padding: 12px 15px;
    border-left: 3px solid var(--primary-color);
}

.detail-label {
    font-size: 0.85rem;
    color: #666;
    margin-bottom: 5px;
}

.detail-value {
    font-weight: 500;
    font-size: 1rem;
}

.modern-table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
}

.modern-table thead th {
    text-align: left;
    padding: 12px 15px;
    color: #555;
    font-weight: 600;
    background-color: #f8f9fa;
}

.modern-table tbody td {
    padding: 12px 15px;
    border-bottom: 1px solid #f0f0f0;
}

.modern-table tbody tr:last-child td {
    border-bottom: none;
}

.modern-table tbody tr:hover {
    background-color: #f8f9fa;
}

.amount-cell {
    text-align: right;
    font-family: 'Courier New', monospace;
}

.total-row {
    font-weight: 600;
    background-color: #f1f8fe;
}

.download-history-btn {
    margin-top: 20px;
    display: flex;
    justify-content: flex-end;
}
        .receipt-message {
    margin-top: 20px;
    padding: 15px;
    background-color: #f9f9f9;
    border-radius: 5px;
    font-size: 0.9rem;
    line-height: 1.5;
}

.receipt-message p {
    margin-bottom: 10px;
}
        /* Add to your existing CSS */
.receipt-card {
    border: 1px solid #eee;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    background-color: white;
    max-width: 800px;
    margin: 0 auto;
}

.receipt-header {
    display: flex;
    justify-content: space-between;
    padding: 20px;
    background-color: #f9f9f9;
    border-bottom: 1px solid #eee;
    flex-wrap: wrap;
}

.receipt-org-info {
    flex: 1;
    min-width: 300px;
}

.receipt-logo {
    height: 60px;
    margin-bottom: 10px;
}

.receipt-title {
    text-align: right;
    min-width: 250px;
}

.receipt-title h3 {
    color: #2c3e50;
    margin-bottom: 5px;
}

.receipt-title p {
    margin: 3px 0;
    font-size: 0.9rem;
    color: #555;
}

.receipt-body {
    padding: 20px;
}

.receipt-donor-info {
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 1px dashed #ddd;
}

.receipt-row {
    display: flex;
    margin-bottom: 8px;
}

.receipt-label {
    font-weight: 600;
    color: #555;
    min-width: 150px;
}

.receipt-value {
    flex: 1;
}

.receipt-message {
    margin-top: 20px;
    padding: 15px;
    background-color: #f9f9f9;
    border-radius: 5px;
    line-height: 1.6;
}

.receipt-message p {
    margin-bottom: 10px;
}

.receipt-contact-info {
    margin-top: 15px;
    font-size: 0.9rem;
}

.receipt-contact-info p {
    margin: 5px 0;
}

.receipt-footer {
    margin-top: 30px;
    text-align: center;
    font-style: italic;
    color: #555;
}

.receipt-signature {
    margin-top: 50px;
    text-align: right;
}

.receipt-signature p:first-child {
    margin-bottom: 5px;
}

.receipt-signature p:last-child {
    font-size: 0.9rem;
}

.receipt-actions {
    padding: 15px;
    border-top: 1px solid #eee;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .receipt-header {
        flex-direction: column;
    }
    
    .receipt-title {
        text-align: left;
        margin-top: 15px;
    }
    
    .receipt-row {
        flex-direction: column;
    }
    
    .receipt-label {
        margin-bottom: 3px;
    }
}
        .no-receipts {
    text-align: center;
    padding: 20px;
    color: #777;
    font-style: italic;
}

.error {
    color: #e74c3c;
    text-align: center;
    padding: 20px;
}
        /* Role Selection Styles */
.role-selection {
    background-color: white;
    border-radius: 10px;
    padding: 30px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    margin-bottom: 30px;
}

.role-selection h2 {
    color: var(--dark-color);
    margin-bottom: 20px;
    text-align: center;
}

.role-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
}

.role-card {
    border: 1px solid #eee;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
}

.role-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    border-color: var(--primary-color);
}

.role-icon {
    width: 60px;
    height: 60px;
    background-color: rgba(52, 152, 219, 0.1);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 15px;
    color: var(--primary-color);
    font-size: 1.5rem;
}

.role-card h3 {
    margin: 0 0 10px 0;
    color: var(--dark-color);
}

.role-card p {
    color: #666;
    font-size: 0.9rem;
    margin: 0;
}

/* Project Modal Styles */
.project-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s;
}

.project-modal.show {
    opacity: 1;
    visibility: visible;
}

/* Projects Table Styles */
.projects-table {
    width: 100%;
    border-collapse: collapse;
}

.projects-table th, 
.projects-table td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid #eee;
}

.projects-table th {
    background-color: #f9f9f9;
    font-weight: 600;
}

.projects-table tr:hover {
    background-color: #f5f5f5;
}

.status-badge {
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
}

.status-badge.active {
    background-color: #e6f7ee;
    color: var(--success-color);
}

.status-badge.planned {
    background-color: #fff5e6;
    color: var(--warning-color);
}

.status-badge.completed {
    background-color: #f0f0f0;
    color: #666;
}
        /* Add this to your existing CSS */
.projects-table, .activities-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

.projects-table th, 
.projects-table td,
.activities-table th,
.activities-table td {
    padding: 15px;
    text-align: left;
    border-bottom: 1px solid #f0f0f0;
}

.projects-table th,
.activities-table th {
    background-color: #f8f9fa;
    font-weight: 600;
    color: #555;
    text-transform: uppercase;
    font-size: 0.8rem;
    letter-spacing: 0.5px;
    position: sticky;
    top: 0;
}

.projects-table tr:last-child td,
.activities-table tr:last-child td {
    border-bottom: none;
}

.projects-table tr:hover,
.activities-table tr:hover {
    background-color: rgba(52, 152, 219, 0.05);
}

/* Status badges */
.status-badge {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    display: inline-block;
    min-width: 80px;
    text-align: center;
    text-transform: capitalize;
}

.status-badge.active {
    background-color: rgba(46, 204, 113, 0.1);
    color: #27ae60;
    border: 1px solid rgba(46, 204, 113, 0.2);
}

.status-badge.planned {
    background-color: rgba(243, 156, 18, 0.1);
    color: #f39c12;
    border: 1px solid rgba(243, 156, 18, 0.2);
}

.status-badge.completed {
    background-color: rgba(149, 165, 166, 0.1);
    color: #7f8c8d;
    border: 1px solid rgba(149, 165, 166, 0.2);
}

.status-badge.in_progress {
    background-color: rgba(52, 152, 219, 0.1);
    color: #2980b9;
    border: 1px solid rgba(52, 152, 219, 0.2);
}

/* Action buttons */
.action-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
    margin: 0 2px;
    color: #95a5a6;
    transition: all 0.2s;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.action-btn:hover {
    background-color: rgba(52, 152, 219, 0.1);
    color: var(--primary-color);
}

.action-btn.delete-btn:hover {
    background-color: rgba(231, 76, 60, 0.1);
    color: var(--accent-color);
}

/* Responsive table */
@media (max-width: 768px) {
    .projects-table, 
    .activities-table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
    }
    
    .projects-table th,
    .projects-table td,
    .activities-table th,
    .activities-table td {
        padding: 10px 12px;
    }
}

/* Modern striped rows */
.projects-table tbody tr:nth-child(even),
.activities-table tbody tr:nth-child(even) {
    background-color: #f9f9f9;
}

.projects-table tbody tr:nth-child(even):hover,
.activities-table tbody tr:nth-child(even):hover {
    background-color: rgba(52, 152, 219, 0.05);
}

/* Add subtle animation to row hover */
.projects-table tbody tr,
.activities-table tbody tr {
    transition: background-color 0.2s ease;
}

/* Modern scrollbar for table container */
.table-responsive {
    border-radius: 10px;
    overflow: hidden;
}

.table-responsive::-webkit-scrollbar {
    height: 8px;
    width: 8px;
}

.table-responsive::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

.table-responsive::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 4px;
}

.table-responsive::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}
/* Director Dashboard - Thematic Areas */
.director-dashboard .role-cards {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
    gap: 20px;
}

.director-dashboard .role-card {
    flex: 1;
    min-width: 250px;
    max-width: 300px;
}

/* Responsive adjustments */
@media (max-width: 992px) {
    .director-dashboard .role-cards {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    }
}

@media (max-width: 768px) {
    .director-dashboard .role-cards {
        grid-template-columns: 1fr;
    }
    
    .director-dashboard .role-card {
        max-width: 100%;
    }
}
.payment-section, .approval-section {
    background-color: white;
    border-radius: 10px;
    padding: 25px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    margin-top: 30px;
}

.payment-actions, .approval-filters {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.approval-filters {
    gap: 15px;
}

.filter-group {
    display: flex;
    align-items: center;
    gap: 10px;
}

.filter-group label {
    font-weight: 600;
    color: #555;
}

.filter-group select {
    padding: 8px 12px;
    border-radius: 4px;
    border: 1px solid #ddd;
}

.payment-history h3, .approval-list h3 {
    margin-bottom: 15px;
    color: var(--dark-color);
}

.payment-details {
    margin-bottom: 20px;
    padding: 15px;
    background-color: #f9f9f9;
    border-radius: 8px;
}

.detail-row {
    display: flex;
    margin-bottom: 10px;
}

.detail-label {
    font-weight: 600;
    color: #555;
    width: 120px;
}

.detail-value {
    flex: 1;
}

.approval-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
}

.status-badge.pending {
    background-color: rgba(243, 156, 18, 0.1);
    color: #f39c12;
    border: 1px solid rgba(243, 156, 18, 0.2);
}

.status-badge.approved {
    background-color: rgba(46, 204, 113, 0.1);
    color: #2ecc71;
    border: 1px solid rgba(46, 204, 113, 0.2);
}

.status-badge.rejected {
    background-color: rgba(231, 76, 60, 0.1);
    color: #e74c3c;
    border: 1px solid rgba(231, 76, 60, 0.2);
}

.status-badge.processed {
    background-color: rgba(52, 152, 219, 0.1);
    color: #3498db;
    border: 1px solid rgba(52, 152, 219, 0.2);
}
        /* Reports Section Styles */
.reports-section {
    background-color: white;
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    margin-top: 2rem;
    box-shadow: var(--shadow-sm);
}

.reports-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.search-filter-container {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
    flex-grow: 1;
}

.search-box {
    position: relative;
    flex: 1;
    min-width: 250px;
}

.search-box i {
    position: absolute;
    left: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--secondary-color);
}

.search-box input {
    width: 100%;
    padding: 0.5rem 1rem 0.5rem 2.5rem;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
}

.filter-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.filter-group label {
    font-size: 0.875rem;
    color: var(--secondary-color);
    white-space: nowrap;
}

.filter-group select {
    padding: 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    font-size: 0.875rem;
}

.custom-date-range {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-left: 1rem;
}

.custom-date-range input {
    padding: 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    font-size: 0.875rem;
}

.custom-date-range span {
    font-size: 0.875rem;
    color: var(--secondary-color);
}

.modern-table {
    width: 100%;
    border-collapse: collapse;
    margin: 1rem 0;
}

.modern-table th {
    background-color: var(--light-color);
    padding: 0.75rem 1rem;
    text-align: left;
    font-weight: 600;
    color: var(--dark-color);
    border-bottom: 2px solid var(--border-color);
}

.modern-table td {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--border-color);
    vertical-align: middle;
}

.modern-table tr:hover {
    background-color: rgba(79, 70, 229, 0.05);
}

.status-badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: capitalize;
}

.status-badge.draft {
    background-color: #fef3c7;
    color: #92400e;
}

.status-badge.submitted {
    background-color: #dbeafe;
    color: #1e40af;
}

.status-badge.approved {
    background-color: #dcfce7;
    color: #166534;
}

.status-badge.rejected {
    background-color: #fee2e2;
    color: #991b1b;
}

.attachment-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.5rem;
    background-color: var(--light-color);
    border-radius: var(--radius-sm);
    font-size: 0.75rem;
    color: var(--secondary-color);
}

.pagination-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin-top: 1rem;
}

#pageInfo {
    font-size: 0.875rem;
    color: var(--secondary-color);
}

/* Report View Modal Styles */
.wide-modal {
    max-width: 900px;
}

.report-meta-info {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border-color);
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.meta-label {
    font-weight: 500;
    color: var(--secondary-color);
}

.meta-value {
    font-weight: 500;
}

.report-content-container {
    display: flex;
    gap: 2rem;
    margin-bottom: 1.5rem;
}

.report-content {
    flex: 2;
    padding: 1rem;
    background-color: var(--light-color);
    border-radius: var(--radius-md);
    max-height: 400px;
    overflow-y: auto;
}

.report-attachments {
    flex: 1;
}

.attachments-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-top: 0.5rem;
}

.attachment-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    text-decoration: none;
    color: var(--dark-color);
    transition: all 0.2s;
}

.attachment-item:hover {
    background-color: rgba(79, 70, 229, 0.05);
    border-color: var(--primary-color);
}

.attachment-icon {
    color: var(--secondary-color);
}

.report-actions {
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--border-color);
}

.status-actions {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .report-content-container {
        flex-direction: column;
    }
    
    .search-filter-container {
        flex-direction: column;
        align-items: stretch;
    }
    
    .filter-group {
        width: 100%;
    }
    
    .custom-date-range {
        margin-left: 0;
        width: 100%;
    }
}
/* Budget Management Modal Styles */
.budget-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 5px;
    margin: 0 3px;
    color: #777;
    transition: color 0.2s;
}

.budget-btn:hover {
    color: #f39c12; /* Orange color for budget button */
}

.form-row {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
}

.form-row .form-group {
    flex: 1;
}

.modal-content {
    max-width: 900px;
    width: 90%;
}

.modal-body {
    max-height: 70vh;
    overflow-y: auto;
}

#budgetItemsTable {
    margin-top: 15px;
}

#budgetItemsTable th, 
#budgetItemsTable td {
    padding: 10px 12px;
}

.total-row td {
    font-weight: 600;
    background-color: #f8f9fa;
}
/* Toast messages */
.toast-message {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #333;
    color: white;
    padding: 12px 24px;
    border-radius: 4px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    z-index: 1001;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.toast-message.show {
    opacity: 1;
}

/* File upload items */
.file-upload-item {
    display: flex;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #eee;
}

.file-upload-item i {
    margin-right: 10px;
    font-size: 1.2rem;
    color: #555;
}

.file-upload-item span:first-of-type {
    flex: 1;
    margin-right: 10px;
}

.file-upload-item span:last-of-type {
    color: #777;
    font-size: 0.9rem;
}

/* Loading states */
.loading {
    text-align: center;
    padding: 20px;
    color: #777;
}

.empty-folder {
    text-align: center;
    padding: 20px;
    color: #777;
    font-style: italic;
    grid-column: 1 / -1;
}

/* Unsupported preview */
.unsupported-preview {
    text-align: center;
    padding: 40px 20px;
}

.unsupported-preview i {
    font-size: 3rem;
    color: #777;
    margin-bottom: 20px;
}

.unsupported-preview p {
    margin: 10px 0;
    color: #555;
}
/* Welcome Dashboard Styles */
.welcome-header {
    display: flex;
    flex-direction: column;
    margin-bottom: 30px;
}

.welcome-message {
    margin-bottom: 20px;
}

.welcome-subtitle {
    font-size: 1.2rem;
    color: #555;
    margin-top: 5px;
    font-weight: 400;
}

.quick-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.stat-item {
    background: white;
    border-radius: 10px;
    padding: 20px;
    display: flex;
    align-items: center;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    transition: transform 0.3s ease;
}

.stat-item:hover {
    transform: translateY(-5px);
}

.stat-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background-color: rgba(52, 152, 219, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
    color: var(--primary-color);
    font-size: 1.5rem;
}

.stat-info {
    display: flex;
    flex-direction: column;
}

.stat-value {
    font-size: 1.8rem;
    font-weight: 700;
    line-height: 1;
}

.stat-label {
    color: #777;
    font-size: 0.9rem;
}

.welcome-card {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    margin-bottom: 20px;
}

.welcome-card.main-card {
    grid-column: 1 / -1;
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.card-header h2 {
    font-size: 1.2rem;
    color: var(--dark-color);
    display: flex;
    align-items: center;
    gap: 10px;
}

.view-all {
    color: var(--primary-color);
    font-size: 0.9rem;
    text-decoration: none;
    font-weight: 500;
}

.announcement-list {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.announcement-item {
    padding-bottom: 20px;
    border-bottom: 1px solid #eee;
}

.announcement-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.announcement-badge {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 600;
    margin-bottom: 8px;
}

.announcement-badge.new {
    background-color: #e6f7ee;
    color: var(--success-color);
}

.announcement-item h3 {
    margin: 0 0 5px 0;
    font-size: 1.1rem;
}

.announcement-meta {
    color: #777;
    font-size: 0.85rem;
    margin-bottom: 10px;
}

.event-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.event-item {
    display: flex;
    gap: 15px;
    align-items: center;
}

.event-date {
    width: 60px;
    height: 60px;
    background-color: #f8f9fa;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.event-day {
    font-size: 1.5rem;
    font-weight: 700;
    line-height: 1;
}

.event-month {
    font-size: 0.8rem;
    text-transform: uppercase;
    color: var(--primary-color);
    font-weight: 600;
    margin-top: 2px;
}

.event-details {
    flex: 1;
}

.event-details h3 {
    margin: 0 0 5px 0;
    font-size: 1rem;
}

.event-time, .event-location {
    font-size: 0.85rem;
    color: #777;
    display: flex;
    align-items: center;
    gap: 5px;
    margin: 3px 0;
}

.quick-actions {
    margin-top: 30px;
}

.section-title {
    font-size: 1.2rem;
    color: var(--dark-color);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.action-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
}

.action-card {
    background: white;
    border-radius: 10px;
    padding: 25px;
    text-decoration: none;
    color: var(--dark-color);
    transition: all 0.3s ease;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.action-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    color: var(--primary-color);
}

.action-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background-color: rgba(52, 152, 219, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 15px;
    color: var(--primary-color);
    font-size: 1.8rem;
}

.action-card h3 {
    margin: 0 0 8px 0;
    font-size: 1.1rem;
}

.action-card p {
    margin: 0;
    color: #777;
    font-size: 0.9rem;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .quick-stats {
        grid-template-columns: 1fr;
    }
    
    .action-grid {
        grid-template-columns: 1fr 1fr;
    }
    
    .welcome-card.main-card {
        grid-column: auto;
    }
}

@media (max-width: 480px) {
    .action-grid {
        grid-template-columns: 1fr;
    }
}
/* Add to your existing CSS */
.role-card {
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.role-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    border-color: var(--primary-color);
}

.role-card:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3);
}

.role-card.active {
    border-color: var(--primary-color);
    background-color: rgba(52, 152, 219, 0.1);
}
/* Add to your existing CSS */
.toast-message {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #333;
    color: white;
    padding: 12px 24px;
    border-radius: 4px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    z-index: 1001;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.toast-message.show {
    opacity: 1;
}

.toast-message.success {
    background-color: var(--success-color);
}

.toast-message.error {
    background-color: var(--accent-color);
}

.status-badge.approved {
    background-color: rgba(46, 204, 113, 0.1);
    color: #27ae60;
    border: 1px solid rgba(46, 204, 113, 0.2);
}

.status-badge.rejected {
    background-color: rgba(231, 76, 60, 0.1);
    color: #e74c3c;
    border: 1px solid rgba(231, 76, 60, 0.2);
}

.status-badge.pending {
    background-color: rgba(52, 152, 219, 0.1);
    color: #2980b9;
    border: 1px solid rgba(52, 152, 219, 0.2);
}

.status-badge.draft {
    background-color: rgba(149, 165, 166, 0.1);
    color: #7f8c8d;
    border: 1px solid rgba(149, 165, 166, 0.2);
}

.action-btn.approve-btn {
    color: var(--success-color);
}

.action-btn.reject-btn {
    color: var(--accent-color);
}

.action-btn.submit-btn {
    color: var(--primary-color);
}
.action-btn.submit-btn {
    color: var(--primary-color);
}

.action-btn.submit-btn:hover {
    background-color: rgba(52, 152, 219, 0.1);
}
.approval-card {
    background-color: white;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}

.approval-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
}

.approval-details {
    margin-top: 10px;
}

.approval-actions {
    margin-top: 15px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.approval-actions input[type="number"],
.approval-actions textarea {
    width: 100%;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.approval-actions textarea {
    min-height: 60px;
    resize: vertical;
}

.approval-actions .file-manager-btn {
    width: 100%;
}
/* Add to your existing CSS */
.action-btn.approve-btn {
    color: var(--success-color);
}

.action-btn.approve-btn:hover {
    background-color: rgba(46, 204, 113, 0.1);
}

.action-btn.reject-btn {
    color: var(--accent-color);
}

.action-btn.reject-btn:hover {
    background-color: rgba(231, 76, 60, 0.1);
}

.action-btn.submit-btn {
    color: var(--warning-color);
}

.action-btn.submit-btn:hover {
    background-color: rgba(241, 196, 15, 0.1);
}
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
            <img src="logo.jpg" alt="RWENZORI COMMUNITY DEVELOPMENT NETWORK Logo">
            <h1>RWENZORI COMMUNITY DEVELOPMENT NETWORK(RCDNET)</h1>
        </div>
        <div class="user-profile">
            <div class="user-info">
                <span class="user-name">Ndyakurungi Mugisha</span>
                <span class="user-role">Chief Executive Director</span>
            </div>
            <img src="mugisha.png" alt="User Profile">
        </div>
    </header>

    <div class="container">
        <aside class="sidebar" id="sidebar">
            <ul class="sidebar-menu">
                <li>
                    <a href="#" class="active" id="dashboardLink">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fas fa-comments"></i>
                        <span>Chat</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fas fa-bullhorn"></i>
                        <span>Notice Board</span>
                    </a>
                </li>
                <li>
                    <a href="#" id="fundraisingLink">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <span>Fundraising Documents</span>
                    </a>
                </li>
                <li>
    <a href="#" id="donationsLink">
        <i class="fas fa-hand-holding-usd"></i>
        <span>Collect Donations</span>
    </a>
</li>
                <li>
                    <a href="#" id="implementProjectLink">
                        <i class="fas fa-chart-pie"></i>
                        <span>Plan and manage</span>
                        <i class="fas fa-chevron-down ml-auto" id="reportsArrow"></i>
                    </a>
                    
                </li>
                <li>
                    <a href="#">
                        <i class="fas fa-users"></i>
                        <span>Beneficiaries</span>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fas fa-file-alt"></i>
                        <span>Reports</span>
                    </a>
                </li>
                
            </ul>
        </aside>

        <main class="main-content" id="mainContent">
            <!-- Dashboard Content -->
            <!-- Replace the existing dashboardContent div with this new version -->
<div id="dashboardContent">
    <div class="welcome-header">
        <div class="welcome-message">
            <h1 class="page-title">
                <i class="fas fa-hands-helping"></i>
                Welcome to Universal Business Management Information System
            </h1>
            <p class="welcome-subtitle">Empowering Communities, Transforming Lives</p>
        </div>
        <div class="quick-stats">
            <div class="stat-item">
                <div class="stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-value">1,500+</span>
                    <span class="stat-label">Beneficiaries</span>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon">
                    <i class="fas fa-project-diagram"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-value">8</span>
                    <span class="stat-label">Active Projects</span>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon">
                    <i class="fas fa-map-marked-alt"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-value">5</span>
                    <span class="stat-label">Districts</span>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-grid">
        <div class="welcome-card main-card">
            <div class="card-header">
                <h2><i class="fas fa-bullhorn"></i> Announcements</h2>
                <a href="#" class="view-all">View All</a>
            </div>
            <div class="announcement-list">
                <div class="announcement-item">
                    <div class="announcement-badge new">New</div>
                    <h3>Quarterly Meeting Scheduled</h3>
                    <p class="announcement-meta">Posted 2 days ago by Justine Muhindo</p>
                    <p>All staff are invited to the quarterly review meeting on Friday at 10:00 AM in the main conference room.</p>
                </div>
                <div class="announcement-item">
                    <h3>New Funding Opportunity</h3>
                    <p class="announcement-meta">Posted 1 week ago by Mugisha Ndyakurungi</p>
                    <p>The KELA Foundation has announced new funding opportunities for women empowerment programs.</p>
                </div>
            </div>
        </div>

        <div class="welcome-card">
            <div class="card-header">
                <h2><i class="fas fa-calendar-alt"></i> Upcoming Events</h2>
                <a href="#" class="view-all">View Calendar</a>
            </div>
            <div class="event-list">
                <div class="event-item">
                    <div class="event-date">
                        <span class="event-day">15</span>
                        <span class="event-month">OCT</span>
                    </div>
                    <div class="event-details">
                        <h3>Community Outreach</h3>
                        <p class="event-time"><i class="fas fa-clock"></i> 8:00 AM - 3:00 PM</p>
                        <p class="event-location"><i class="fas fa-map-marker-alt"></i> Kasese District</p>
                    </div>
                </div>
                <div class="event-item">
                    <div class="event-date">
                        <span class="event-day">22</span>
                        <span class="event-month">OCT</span>
                    </div>
                    <div class="event-details">
                        <h3>Donor Appreciation Day</h3>
                        <p class="event-time"><i class="fas fa-clock"></i> 10:00 AM - 2:00 PM</p>
                        <p class="event-location"><i class="fas fa-map-marker-alt"></i> RCDNET Headquarters</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="quick-actions">
        <h2 class="section-title"><i class="fas fa-bolt"></i> Quick Actions</h2>
        <div class="action-grid">
            <a href="#" class="action-card" id="quickAddDonation">
                <div class="action-icon">
                    <i class="fas fa-hand-holding-usd"></i>
                </div>
                <h3>Record Donation</h3>
                <p>Add a new donation to the system</p>
            </a>
            <a href="#" class="action-card" id="quickCreateReport">
                <div class="action-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <h3>Create Report</h3>
                <p>Generate a new activity report</p>
            </a>
            <a href="#" class="action-card" id="quickAddBeneficiary">
                <div class="action-icon">
                    <i class="fas fa-user-plus"></i>
                </div>
                <h3>Add Beneficiary</h3>
                <p>Register a new program beneficiary</p>
            </a>
            <a href="#" class="action-card" id="quickScheduleActivity">
                <div class="action-icon">
                    <i class="fas fa-tasks"></i>
                </div>
                <h3>Schedule Activity</h3>
                <p>Plan a new field activity</p>
            </a>
        </div>
    </div>
</div>
            <!-- Enhanced File Manager Content -->
            <div id="fileManagerContent" class="file-manager-container">
                <div class="file-manager-header">
                    <h1 class="page-title">
                        <i class="fas fa-folder-open"></i>
                        Fundraising Documents
                    </h1>
                    <div class="file-manager-actions">
                        <button class="file-manager-btn" id="uploadFilesBtn">
                            <i class="fas fa-upload"></i> Upload
                        </button>
                        <button class="file-manager-btn secondary" id="createFolderBtn">
                            <i class="fas fa-folder-plus"></i> New Folder
                        </button>
                    </div>
                </div>

                <div class="breadcrumb" id="breadcrumb">
                    <span class="breadcrumb-item" data-path="">Fundraising Documents</span>
                </div>

                <div class="file-manager-grid" id="fileManagerGrid">
                    <!-- Folders will be added here -->
                    <div class="folder-item" data-folder-id="1" data-folder-name="Proposals">
                        <div class="folder-icon">
                            <i class="fas fa-folder"></i>
                        </div>
                        <div class="folder-name">Proposals</div>
                        <div class="file-actions-menu" onclick="toggleFolderActions(event, 1)">
                            <i class="fas fa-ellipsis-v"></i>
                        </div>
                        <div class="file-actions-dropdown" id="folder-actions-1">
                            <div class="file-action-item" onclick="renameFolder(1, 'Proposals')">
                                <i class="fas fa-pencil-alt"></i> Rename
                            </div>
                            <div class="file-action-item" onclick="deleteFolder(1)">
                                <i class="fas fa-trash"></i> Delete
                            </div>
                        </div>
                    </div>

                    <div class="folder-item" data-folder-id="2" data-folder-name="Reports">
                        <div class="folder-icon">
                            <i class="fas fa-folder"></i>
                        </div>
                        <div class="folder-name">Reports</div>
                        <div class="file-actions-menu" onclick="toggleFolderActions(event, 2)">
                            <i class="fas fa-ellipsis-v"></i>
                        </div>
                        <div class="file-actions-dropdown" id="folder-actions-2">
                            <div class="file-action-item" onclick="renameFolder(2, 'Reports')">
                                <i class="fas fa-pencil-alt"></i> Rename
                            </div>
                            <div class="file-action-item" onclick="deleteFolder(2)">
                                <i class="fas fa-trash"></i> Delete
                            </div>
                        </div>
                    </div>

                    <!-- Files will be added here -->
                    <div class="file-item" data-file-id="1" data-file-name="Annual_Report_2023.pdf">
                        <div class="file-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="file-name">Annual_Report_2023.pdf</div>
                        <div class="file-actions-menu" onclick="toggleFileActions(event, 1)">
                            <i class="fas fa-ellipsis-v"></i>
                        </div>
                        <div class="file-actions-dropdown" id="file-actions-1">
                            <div class="file-action-item" onclick="previewFile(1, 'Annual_Report_2023.pdf', 'pdf')">
                                <i class="fas fa-eye"></i> Preview
                            </div>
                            <div class="file-action-item" onclick="downloadFile(1, 'Annual_Report_2023.pdf')">
                                <i class="fas fa-download"></i> Download
                            </div>
                            <div class="file-action-item" onclick="renameFile(1, 'Annual_Report_2023.pdf')">
                                <i class="fas fa-pencil-alt"></i> Rename
                            </div>
                            <div class="file-action-item" onclick="deleteFile(1, 'Annual_Report_2023.pdf')">
                                <i class="fas fa-trash"></i> Delete
                            </div>
                        </div>
                    </div>

                    <div class="file-item" data-file-id="2" data-file-name="Budget_2024.xlsx">
                        <div class="file-icon">
                            <i class="fas fa-file-excel"></i>
                        </div>
                        <div class="file-name">Budget_2024.xlsx</div>
                        <div class="file-actions-menu" onclick="toggleFileActions(event, 2)">
                            <i class="fas fa-ellipsis-v"></i>
                        </div>
                        <div class="file-actions-dropdown" id="file-actions-2">
                            <div class="file-action-item" onclick="previewFile(2, 'Budget_2024.xlsx', 'xlsx')">
                                <i class="fas fa-eye"></i> Preview
                            </div>
                            <div class="file-action-item" onclick="downloadFile(2, 'Budget_2024.xlsx')">
                                <i class="fas fa-download"></i> Download
                            </div>
                            <div class="file-action-item" onclick="renameFile(2, 'Budget_2024.xlsx')">
                                <i class="fas fa-pencil-alt"></i> Rename
                            </div>
                            <div class="file-action-item" onclick="deleteFile(2, 'Budget_2024.xlsx')">
                                <i class="fas fa-trash"></i> Delete
                            </div>
                        </div>
                    </div>
                </div>
            </div>
                        <!-- Donations Collection Content -->
            <div id="donationsContent" class="donations-container" style="display: none;">
                <h1 class="page-title">
                    <i class="fas fa-hand-holding-usd"></i>
                    Collect Donations
                </h1>

                <div class="donations-tabs">
                    <button class="tab-btn active" data-tab="donationHistory">Donations</button>
                    <button class="tab-btn" data-tab="receipts">Receipts/Invoices</button>
                    <button class="tab-btn" data-tab="donorProfiles">Donor Profiles</button>
                </div>

                <div class="tab-content active" id="donationHistory">
                    <div class="section-header">
                        <h2 class="section-title">Recent Donations</h2>
                        <button class="file-manager-btn" id="addDonationBtn">
                            <i class="fas fa-plus"></i> Add Donation
                        </button>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="donations-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Donor</th>
                                    <th>Amount</th>
                                    <th>Payment Method</th>
                                    <th>Campaign/Project</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="donationsTableBody">
                             <!-- Donations will be loaded here dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="receipts">
                    <div class="section-header">
                        <h2 class="section-title">Generate Receipts/Invoices</h2>
                    </div>
    
                    <div class="receipts-grid" id="receiptsGrid">
                        <!-- Receipts will be dynamically added here -->
                    </div>
                </div>

                
                <div class="tab-content" id="donorProfiles">
                    <div class="section-header">
                        <h2 class="section-title">Donor Profiles</h2>
                        <button class="file-manager-btn" id="addDonorBtn">
                            <i class="fas fa-plus"></i> Add Donor
                        </button>
                    </div>
                    
                    <div class="donor-cards">
                        <div class="donor-card">
                            <div class="donor-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="donor-info">
                                <h3 class="donor-name">Mumbere Darius</h3>
                                <div class="donor-contact">
                                    <span><i class="fas fa-envelope"></i> dariusmumbere@gmail.com</span>
                                    <span><i class="fas fa-phone"></i> +256 712 345 678</span>
                                </div>
                                <div class="donor-stats">
                                    <div class="stat-item">
                                        <span class="stat-label">Total Donations:</span>
                                        <span class="stat-value">UGX 2,500,000</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Last Donation:</span>
                                        <span class="stat-value">2023-10-15</span>
                                    </div>
                                </div>
                            </div>
                            <div class="donor-actions">
                                <button class="file-manager-btn secondary"><i class="fas fa-edit"></i> Edit</button>
                                <button class="file-manager-btn"><i class="fas fa-history"></i> View History</button>
                                <button class="file-manager-btn delete-btn" onclick="deleteDonor(${donor.id})">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                        
                        <div class="donor-card">
                            <div class="donor-avatar">
                                <i class="fas fa-building"></i>
                            </div>
                            <div class="donor-info">
                                <h3 class="donor-name">Acme Corp</h3>
                                <div class="donor-contact">
                                    <span><i class="fas fa-envelope"></i> contact@acme.com</span>
                                    <span><i class="fas fa-phone"></i> +256 312 345 678</span>
                                </div>
                                <div class="donor-stats">
                                    <div class="stat-item">
                                        <span class="stat-label">Total Donations:</span>
                                        <span class="stat-value">UGX 5,000,000</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Last Donation:</span>
                                        <span class="stat-value">2023-10-10</span>
                                    </div>
                                </div>
                            </div>
                            <div class="donor-actions">
                                <button class="file-manager-btn secondary"><i class="fas fa-edit"></i> Edit</button>
                                <button class="file-manager-btn"><i class="fas fa-history"></i> View History</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add Donation Modal -->
                <div class="donation-modal" id="addDonationModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Add New Donation</h3>
                            <button class="close-btn" onclick="closeDonationModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <form id="donationForm">
                                <div class="form-group">
                                    <label for="donorName">Donor Name</label>
                                    <input type="text" id="donorName" list="donorNamesList" required>
                                    <datalist id="donorNamesList">
                                        <!-- Donor options will be populated here -->
                                    </datalist>
                                </div>
                                <div class="form-group">
                                    <label for="donationAmount">Amount (UGX)</label>
                                    <input type="number" id="donationAmount" required>
                                </div>
                                <div class="form-group">
                                    <label for="paymentMethod">Payment Method</label>
                                    <select id="paymentMethod" required>
                                        <option value="">Select method</option>
                                        <option value="mobile_money">Mobile Money</option>
                                        <option value="bank_transfer">Bank Transfer</option>
                                        <option value="western_union">Western Union</option>
                                        <option value="paypal">PayPal</option>
                                        <option value="cash">Cash</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="donationDate">Date</label>
                                    <input type="date" id="donationDate" required>
                                </div>
                                <div class="form-group">
                                    <label for="donationProject">Program Area</label>
                                    <select id="donationProject">
                                        <option value="Reproductive Health">Reproductive Health</option>
                                        <option value="Climate Change">Climate Change</option>
                                        <option value="Vocational Education">Vocational Education</option>
                                        <option value="Women Empowerment">Women Empowerment</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="donationNotes">Notes</label>
                                    <textarea id="donationNotes" rows="3"></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="file-manager-btn secondary" onclick="closeDonationModal()">Cancel</button>
                            <button class="file-manager-btn" onclick="submitDonation()">Save Donation</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Add this modal to your HTML (place it with the other modals) -->
            
<div class="donor-modal" id="donorModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="donorModalTitle">Donor Profile</h3>
            <button class="close-btn" onclick="closeDonorModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="donorForm">
                <input type="hidden" id="donorId">
                <div class="form-group">
                    <label for="donorName">Name*</label>
                    <input type="text" id="donorProfileName" required>
                    <div class="validation-error" id="nameError" style="color: red; display: none;">Please enter donor name</div>
                </div>
                <div class="form-group">
                    <label for="donorEmail">Email</label>
                    <input type="email" id="donorEmail">
                </div>
                <div class="form-group">
                    <label for="donorPhone">Phone</label>
                    <input type="tel" id="donorPhone">
                </div>
                <div class="form-group">
                    <label for="donorAddress">Address</label>
                    <textarea id="donorAddress" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label for="donorType">Donor Type</label>
                    <select id="donorType">
                        <option value="individual">Individual</option>
                        <option value="corporate">Corporate</option>
                        <option value="foundation">Foundation</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="donorCategory">Donor Category</label>
                    <select id="donorCategory">
                        <option value="one-time">One-time Donor</option>
                        <option value="regular">Regular Donor</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="donorNotes">Notes</label>
                    <textarea id="donorNotes" rows="3"></textarea>
                </div>
            </form>
            
            <div class="section-header" style="margin-top: 30px;">
                <h3 class="section-title">Donation History</h3>
            </div>
            <div class="table-responsive">
                <table class="donations-table" id="donorDonationsTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Amount</th>
                            <th>Project</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Donation history will be loaded here -->
                    </tbody>
                </table>
            </div>
            
            <div class="donor-stats" style="margin-top: 20px;">
                <div class="stat-item">
                    <span class="stat-label">Total Donations:</span>
                    <span class="stat-value" id="totalDonations">UGX 0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Donation Count:</span>
                    <span class="stat-value" id="donationCount">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">First Donation:</span>
                    <span class="stat-value" id="firstDonation">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Last Donation:</span>
                    <span class="stat-value" id="lastDonation">-</span>
                </div>
            </div>
        </div>
        <div class="donation-history-container">
    <div class="donation-history-header">
        <h2 class="donation-history-title">Donation History</h2>
        <div class="total-amount">Total: UGX <span id="historyTotalAmount">0</span></div>
    </div>
    
    <div class="donor-details-grid">
        <div class="detail-box">
            <div class="detail-label">Charity/Organization Name</div>
            <div class="detail-value">Rwenzori Community Development Network</div>
        </div>
        <div class="detail-box">
            <div class="detail-label">Project Name</div>
            <div class="detail-value" id="historyProjectName">Loading...</div>
        </div>
        <div class="detail-box">
            <div class="detail-label">Donor Category</div>
            <div class="detail-value" id="historyDonorCategory">Loading...</div>
        </div>
        <div class="detail-box">
            <div class="detail-label">Donor Address</div>
            <div class="detail-value" id="historyDonorAddress">Loading...</div>
        </div>
        <div class="detail-box">
            <div class="detail-label">Donor ID</div>
            <div class="detail-value" id="historyDonorId">Loading...</div>
        </div>
        <div class="detail-box">
            <div class="detail-label">Time Period</div>
            <div class="detail-value" id="historyTimePeriod">Loading...</div>
        </div>
    </div>
    
    <div class="table-responsive">
        <table class="modern-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Amount (UGX)</th>
                    <th>Payment Method</th>
                    <th>Project</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="donationHistoryTableBody">
                <!-- Donation history rows will be inserted here -->
            </tbody>
            <tfoot>
                <tr class="total-row">
                    <td colspan="4">Total</td>
                    <td class="amount-cell" id="historyTableTotal">UGX 0</td>
                </tr>
            </tfoot>
        </table>
    </div>
    
    <div class="download-history-btn">
        <button class="file-manager-btn" id="downloadHistoryBtn">
            <i class="fas fa-download"></i> Download Donation History
        </button>
    </div>
</div>
        <div class="modal-footer">
            <button class="file-manager-btn secondary" onclick="closeDonorModal()">Close</button>
            <button class="file-manager-btn" id="saveDonorBtn" type="button" onclick="document.getElementById('donorForm').dispatchEvent(new Event('submit'))">
                <i class="fas fa-save"></i> Save Donor
            </button>
         
        </div>
    </div>
</div>


            <!-- File Preview Modal -->
            <div class="file-preview-modal" id="filePreviewModal">
                <div class="file-preview-content">
                    <div class="file-preview-header">
                        <h3 id="previewFileName">File Preview</h3>
                        <button class="file-manager-btn secondary" onclick="closePreview()">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                    <div class="file-preview-body" id="previewFileContent">
                        <!-- Content will be loaded here -->
                    </div>
                    <div class="file-preview-actions">
                        <button class="file-manager-btn" onclick="downloadCurrentFile()">
                            <i class="fas fa-download"></i> Download
                        </button>
                        <button class="file-manager-btn secondary" onclick="closePreview()">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                </div>
            </div>

            <!-- Create Folder Modal -->
            <div class="folder-create-modal" id="folderCreateModal">
                <div class="folder-create-content">
                    <div class="folder-create-header">
                        <h3>Create New Folder</h3>
                    </div>
                    <div class="folder-create-body">
                        <input type="text" class="folder-create-input" id="newFolderName" placeholder="Folder name">
                    </div>
                    <div class="folder-create-actions">
                        <button class="file-manager-btn secondary" onclick="closeCreateFolderModal()">
                            Cancel
                        </button>
                        <button class="file-manager-btn" onclick="createNewFolder()">
                            Create
                        </button>
                    </div>
                </div>
            </div>
            <!-- Budget Approval Modal -->
<div class="project-modal" id="approvalModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Approve Budget</h3>
            <button class="close-btn" onclick="closeModal('approvalModal')">&times;</button>
        </div>
        <div class="modal-body">
            <p>Activity: <strong id="approvalActivityName"></strong></p>
            <input type="hidden" id="approvalActivityId">
            
            <div class="form-group">
                <label for="approvalRemarks">Remarks</label>
                <textarea id="approvalRemarks" rows="3" placeholder="Optional comments"></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="file-manager-btn secondary" onclick="closeModal('approvalModal')">Cancel</button>
            <button class="file-manager-btn" onclick="submitBudgetApproval(true)">
                <i class="fas fa-check"></i> Approve Budget
            </button>
        </div>
    </div>
</div>

            <!-- Upload Modal -->
            <div class="upload-modal" id="uploadModal">
                <div class="upload-content">
                    <div class="upload-header">
                        <h3>Upload Files</h3>
                    </div>
                    <div class="upload-area" id="uploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Drag & drop files here or <span class="browse-btn" id="browseFilesBtn">browse</span></p>
                        <p class="small">Supported formats: PDF, DOCX, XLSX, PPTX, JPG, PNG</p>
                        <input type="file" id="fileUploadInput" multiple>
                    </div>
                    <div class="upload-progress" id="uploadProgress">
                        <p>Uploading files...</p>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" id="progressBarFill"></div>
                        </div>
                    </div>
                    <div class="upload-actions">
                        <button class="file-manager-btn secondary" onclick="closeUploadModal()">
                            Cancel
                        </button>
                        <button class="file-manager-btn" id="startUploadBtn" disabled>
                            <i class="fas fa-upload"></i> Upload
                        </button>
                    </div>
                </div>
            </div>
            <div id="implementProjectContent" style="display: none;">
    <h1 class="page-title">
        <i class="fas fa-project-diagram"></i>
        Roles
    </h1>

    <!-- Role Selection Section -->
    <div class="role-selection" id="roleSelection">
    <h2>Select Your Role</h2>
    <div class="role-cards">
        <div class="role-card" onclick="selectRole('director')" tabindex="0">
            <div class="role-icon">
                <i class="fas fa-user-tie"></i>
            </div>
            <h3>Director</h3>
            <p>Create projects, allocate funds, and oversee implementation</p>
        </div>
        
        <div class="role-card" onclick="selectRole('program_officer')" tabindex="0">
            <div class="role-icon">
                <i class="fas fa-user-cog"></i>
            </div>
            <h3>Head of programs</h3>
            <p>Manage project activities and coordinate implementation</p>
        </div>
        
        <div class="role-card" onclick="selectRole('human_resource')" tabindex="0">
            <div class="role-icon">
                <i class="fas fa-users"></i>
            </div>
            <h3>Human Resource</h3>
            <p>Manage staff assignments and project teams</p>
        </div>
        
        <div class="role-card" onclick="selectRole('finance')" tabindex="0">
            <div class="role-icon">
                <i class="fas fa-money-bill-wave"></i>
            </div>
            <h3>Finance</h3>
            <p>Handle project budgets and financial reporting</p>
        </div>
    </div>
</div>
                
<div class="director-dashboard" id="directorDashboard" style="display: none;">
    <div class="director-dashboard-header">
        <h2 class="section-title">Director Dashboard</h2>
        <button class="file-manager-btn" id="manageProjectsBtn">
            <i class="fas fa-project-diagram"></i> <a href="https://ubmis.com/projects">Manage Projects</a>
        </button>
        <button class="file-manager-btn" id="reportsBtn" style="margin-left: 10px;">
            <i class="fas fa-file-alt"></i> <a href="https://ubmis.com/submit">Reports</a>
        </button>
    </div>

    <!-- Bank Cards Section -->
    <div class="bank-cards-container">
        <!-- Main Bank Card -->
        <div class="bank-card main-bank-card">
            <div class="bank-card-header">
                <div class="bank-card-title">Main Account</div>
                <div class="bank-card-logo">
                    <i class="fas fa-university"></i>
                </div>
            </div>
            <div class="bank-card-balance">0</div>
        </div>
        
        <!-- Program Area Cards -->
        <div class="bank-card program-card-1">
            <div class="bank-card-header">
                <div class="bank-card-title">Women Empowerment</div>
                <div class="bank-card-logo">
                    <i class="fas fa-fist-raised"></i>
                </div>
            </div>
            <div class="bank-card-balance">0</div>
        </div>
        
        <div class="bank-card program-card-2">
            <div class="bank-card-header">
                <div class="bank-card-title">Vocational Education</div>
                <div class="bank-card-logo">
                    <i class="fas fa-tools"></i>
                </div>
            </div>
            <div class="bank-card-balance">0</div>    
        </div>
        
        <div class="bank-card program-card-3">
            <div class="bank-card-header">
                <div class="bank-card-title">Climate Change</div>
                <div class="bank-card-logo">
                    <i class="fas fa-leaf"></i>
                </div>
            </div>
            <div class="bank-card-balance">0</div>
        </div>
        
        <div class="bank-card program-card-4">
            <div class="bank-card-header">
                <div class="bank-card-title">Reproductive Health</div>
                <div class="bank-card-logo">
                    <i class="fas fa-heartbeat"></i>
                </div>
            </div>
            <div class="bank-card-balance">0</div>
        </div>
    </div>
    
</div>
    <div class="approval-section">
    <div class="section-header">
        <h3 class="section-title">Pending Budget Approvals</h3>
        <button class="file-manager-btn secondary" id="refreshApprovalsBtn">
            <i class="fas fa-sync-alt"></i> Refresh
        </button>
    </div>
    <div id="pendingApprovalsContainer">
        <!-- Approvals will be loaded here -->
    </div>
</div>
    <div class="projects-list">
        <h3>Current Projects</h3>
        <div class="table-responsive">
            <table class="projects-table">
                <thead>
                    <tr>
                        <th>Project Name</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Budget (UGX)</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="projectsTableBody">
                    <!-- Projects will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>
</div>

    <!-- Program Officer Dashboard (initially hidden) -->
    <div class="program-officer-dashboard" id="programOfficerDashboard" style="display: none;">
        <div class="section-header">
            <h2 class="section-title">Program Officer Dashboard</h2>
            <button class="file-manager-btn" id="createActivityBtn">
                <i class="fas fa-plus"></i> Create New Activity
            </button>
        </div>

    <div>
        <div class="role-selection" id="roleSelection">
        <h2>Select program area</h2>
        <div class="role-cards">
    <div class="role-card" onclick="navigateToProgramArea(1, 'Women Empowerment')">
        <div class="role-icon">
            <i class="fas fa-fist-raised"></i>
        </div>
        <h3>Women Empowerment</h3>
        <p>Support women's rights, leadership, and economic opportunities.</p>
    </div>
    
    <div class="role-card" onclick="navigateToProgramArea(2, 'Vocational Education')">
        <div class="role-icon">
            <i class="fas fa-tools"></i>
        </div>
        <h3>Vocational Education</h3>
        <p>Provide skill-based training and employment opportunities.</p>
    </div>
    
    <div class="role-card" onclick="navigateToProgramArea(3, 'Climate Change Mitigation')">
        <div class="role-icon">
            <i class="fas fa-leaf"></i>
        </div>
        <h3>Climate Change Mitigation</h3>
        <p>Promote sustainable practices and environmental awareness.</p>
    </div>
    
    <div class="role-card" onclick="navigateToProgramArea(4, 'Reproductive Health')">
        <div class="role-icon">
            <i class="fas fa-heartbeat"></i>
        </div>
        <h3>Reproductive Health</h3>
        <p>Ensure access to quality reproductive health services and education.</p>
    </div>
</div>
    </div>

        <div class="activities-list">
            <h3>Current Activities</h3>
            <div class="table-responsive">
                <table class="activities-table">
                    <thead>
                        <tr>
                            <th>Activity Name</th>
                            <th>Project</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Budget (UGX)</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="activitiesTableBody">
                        <!-- Activities will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
       
    </div>
    

    <!-- Create Project Modal -->
    <div class="project-modal" id="createProjectModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Project</h3>
                <button class="close-btn" onclick="closeModal('createProjectModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="projectForm">
                    <div class="form-group">
                        <label for="projectName">Project Name*</label>
                        <input type="text" id="projectName" required>
                    </div>
                    <div class="form-group">
                        <label for="projectDescription">Description</label>
                        <textarea id="projectDescription" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="projectStartDate">Start Date*</label>
                        <input type="date" id="projectStartDate" required>
                    </div>
                    <div class="form-group">
                        <label for="projectEndDate">End Date*</label>
                        <input type="date" id="projectEndDate" required>
                    </div>
                    <div class="form-group">
                        <label for="projectBudget">Budget (UGX)*</label>
                        <input type="number" id="projectBudget" required>
                    </div>
                    <div class="form-group">
                        <label for="projectFunds">Attach Funds From</label>
                        <select id="projectFunds">
                            <option value="general">General Funds</option>
                            <option value="donation">Specific Donation</option>
                            <option value="grant">Grant Funding</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="file-manager-btn secondary" onclick="closeModal('createProjectModal')">Cancel</button>
                <button class="file-manager-btn" onclick="createProject()">Create Project</button>
            </div>
        </div>
    </div>

     <!-- Create Activity Modal -->
    <div class="project-modal" id="createActivityModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Activity</h3>
                <button class="close-btn" onclick="closeModal('createActivityModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="activityForm">
                    <div class="form-group">
                        <label for="activityName">Activity Name*</label>
                        <input type="text" id="activityName" required>
                    </div>
                    <div class="form-group">
                        <label for="activityProject">Project*</label>
                        <select id="activityProject" required>
                            <!-- Projects will be loaded here -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="activityDescription">Description</label>
                        <textarea id="activityDescription" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="activityStartDate">Start Date*</label>
                        <input type="date" id="activityStartDate" required>
                    </div>
                    <div class="form-group">
                        <label for="activityEndDate">End Date*</label>
                        <input type="date" id="activityEndDate" required>
                    </div>
                    <div class="form-group">
                        <label for="activityBudget">Budget (UGX)*</label>
                        <input type="number" id="activityBudget" required>
                    </div>
                    <div class="form-group">
                        <label for="activityStatus">Status</label>
                        <select id="activityStatus">
                            <option value="planned">Planned</option>
                            <option value="in_progress">In Progress</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="file-manager-btn secondary" onclick="closeModal('createActivityModal')">Cancel</button>
                <button class="file-manager-btn" onclick="createActivity()">Create Activity</button>
            </div>
        </div>
    </div>
</div>
<div id="programAreaContent" style="display: none;">
    <div class="program-area-header">
        <h1 class="page-title" id="programAreaTitle">
            <i class="fas fa-project-diagram"></i>
            <span id="programAreaName">Program Area</span>
        </h1>
        <button class="file-manager-btn" id="addProjectToProgramBtn">
            <i class="fas fa-plus"></i> Add Project
        </button>
    </div>

    <div class="projects-list">
        <div class="table-responsive">
            <table class="projects-table">
                <thead>
                    <tr>
                        <th>Project Name</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Budget (UGX)</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="programAreaProjectsTableBody">
                    <!-- Projects will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>
</div>
            <!-- Budget Creation Modal -->
<div class="project-modal" id="createBudgetModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Create Budget Item for <span id="budgetForActivityName"></span></h3>
            <button class="close-btn" onclick="closeModal('createBudgetModal')">&times;</button>
        </div>
        <div class="modal-body">
            <form id="budgetForm">
                <div class="form-group">
                    <label for="budgetItemName">Item Name*</label>
                    <input type="text" id="budgetItemName" required>
                </div>
                <div class="form-group">
                    <label for="budgetItemDescription">Description</label>
                    <textarea id="budgetItemDescription" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label for="budgetItemQuantity">Quantity*</label>
                    <input type="number" id="budgetItemQuantity" value="1" min="1" step="1" required>
                </div>
                <div class="form-group">
                    <label for="budgetItemUnitPrice">Unit Price (UGX)*</label>
                    <input type="number" id="budgetItemUnitPrice" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="budgetItemCategory">Category*</label>
                    <select id="budgetItemCategory" required>
                        <option value="materials">Materials</option>
                        <option value="labor">Labor</option>
                        <option value="transport">Transport</option>
                        <option value="equipment">Equipment</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="file-manager-btn secondary" onclick="closeModal('createBudgetModal')">Cancel</button>
            <button class="file-manager-btn" onclick="createBudgetItem()">Create Budget Item</button>
        </div>
    </div>
</div>
            

        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
    loadProgramCards();
    const menuToggle = document.getElementById('menuToggle');
    const sidebar = document.getElementById('sidebar');
    const reportsMenu = document.getElementById('reportsMenu');
    const reportsSubmenu = document.getElementById('reportsSubmenu');
    const reportsArrow = document.getElementById('reportsArrow');
    const dashboardLink = document.getElementById('dashboardLink');
    const fundraisingLink = document.getElementById('fundraisingLink');
    const dashboardContent = document.getElementById('dashboardContent');
    const fileManagerContent = document.getElementById('fileManagerContent');
    const uploadFilesBtn = document.getElementById('uploadFilesBtn');
    const createFolderBtn = document.getElementById('createFolderBtn');
    const browseFilesBtn = document.getElementById('browseFilesBtn');
    const fileUploadInput = document.getElementById('fileUploadInput');
    const startUploadBtn = document.getElementById('startUploadBtn');
    const uploadProgress = document.getElementById('uploadProgress');
    const progressBarFill = document.getElementById('progressBarFill');
    const donationsContent = document.getElementById('donationsContent');
            document.getElementById('implementProjectLink').addEventListener('click', function(e) {
    e.preventDefault();
    dashboardContent.style.display = 'none';
    fileManagerContent.style.display = 'none';
    donationsContent.style.display = 'none';
    document.getElementById('implementProjectContent').style.display = 'block';
    
    // Show role selection by default
    document.getElementById('roleSelection').style.display = 'block';
    document.getElementById('directorDashboard').style.display = 'none';
    
    setActiveNavItem(this);
});

    

    // Initialize with saved path or empty
    let currentPath = loadCurrentPath();
    let currentFileId = null;
    let currentFileName = null;
    let currentFileType = null;
    let filesToUpload = [];

    // Initialize by showing dashboard and hiding file manager
    dashboardContent.style.display = 'block';
    fileManagerContent.style.display = 'none';

    // Toggle sidebar collapse/expand
    menuToggle.addEventListener('click', function() {
                if (window.innerWidth <= 768) {
                    sidebar.classList.toggle('show');
                } else {
                    sidebar.classList.toggle('collapsed');
                    
                    const icon = menuToggle.querySelector('i');
                    if (sidebar.classList.contains('collapsed')) {
                        icon.classList.remove('fa-bars');
                        icon.classList.add('fa-indent');
                    } else {
                        icon.classList.remove('fa-indent');
                        icon.classList.add('fa-bars');
                    }
                }
            });
            document.addEventListener('click', function(e) {
                if (window.innerWidth <= 768 && sidebar.classList.contains('show')) {
                    if (!e.target.closest('.sidebar') && !e.target.closest('.menu-toggle')) {
                        sidebar.classList.remove('show');
                    }
                }
            });

    // Toggle reports submenu
    reportsMenu.addEventListener('click', function(e) {
        e.preventDefault();
        reportsSubmenu.classList.toggle('show');
        reportsArrow.classList.toggle('fa-chevron-down');
        reportsArrow.classList.toggle('fa-chevron-up');
    });

    // Navigation between dashboard and file manager
    dashboardLink.addEventListener('click', function(e) {
        e.preventDefault();
        dashboardContent.style.display = 'block';
        fileManagerContent.style.display = 'none';
        setActiveNavItem(dashboardLink);
        loadProgramCards();
    });

    fundraisingLink.addEventListener('click', function(e) {
        e.preventDefault();
        dashboardContent.style.display = 'none';
        fileManagerContent.style.display = 'block';
        setActiveNavItem(fundraisingLink);
        
        // Load content for current path
        const folderId = currentPath.length > 0 ? currentPath[currentPath.length - 1].id : '';
        loadFolderContents(folderId);
    });



    // Expose functions to global scope for inline event handlers
    window.toggleFileActions = toggleFileActions;
    window.toggleFolderActions = toggleFolderActions;
    window.previewFile = previewFile;
    window.downloadFile = downloadFile;
    window.renameFile = renameFile;
    window.deleteFile = deleteFile;
    window.renameFolder = renameFolder;
    window.deleteFolder = deleteFolder;
    window.closePreview = closePreview;
    window.downloadCurrentFile = downloadCurrentFile;
    window.closeCreateFolderModal = closeCreateFolderModal;
    window.createNewFolder = createNewFolder;
});
                // Donations Page Functionality
        const donationsLink = document.getElementById('donationsLink');
        const donationsContent = document.getElementById('donationsContent');
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        const addDonationBtn = document.getElementById('addDonationBtn');
        const addDonationModal = document.getElementById('addDonationModal');

        // Navigation to donations page
        donationsLink.addEventListener('click', function(e) {
    e.preventDefault();
    dashboardContent.style.display = 'none';
    fileManagerContent.style.display = 'none';
    donationsContent.style.display = 'block';
    setActiveNavItem(donationsLink);
});

        // Tab switching
        tabBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from all buttons and contents
                tabBtns.forEach(b => b.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked button and corresponding content
                this.classList.add('active');
                const tabId = this.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Add donation modal
        addDonationBtn.addEventListener('click', function() {
            addDonationModal.classList.add('show');
        });

        function closeDonationModal() {
            addDonationModal.classList.remove('show');
        }

        function submitDonation() {
            // Here you would normally send the data to your backend
            alert('Donation submitted successfully!');
            closeDonationModal();
            // Reset form
            document.getElementById('donationForm').reset();
        }

        // Close modal when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target === addDonationModal) {
                closeDonationModal();
            }
        });

        // Expose functions to global scope
        window.closeDonationModal = closeDonationModal;
        window.submitDonation = submitDonation;

         async function submitDonation() {
    const donationId = document.getElementById('addDonationModal').dataset.donationId;
    const isEdit = !!donationId;
    
    const donorName = document.getElementById('donorName').value;
    const donationAmount = parseFloat(document.getElementById('donationAmount').value);
    const paymentMethod = document.getElementById('paymentMethod').value;
    const donationDate = document.getElementById('donationDate').value;
    const donationProject = document.getElementById('donationProject').value;
    const donationNotes = document.getElementById('donationNotes').value;

    if (!donorName || !donationAmount || !paymentMethod || !donationDate) {
        alert('Please fill in all required fields');
        return;
    }

    try {
        const submitBtn = document.querySelector('#addDonationModal .modal-footer .file-manager-btn');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        submitBtn.disabled = true;

        const url = isEdit 
            ? `https://man-m681.onrender.com/donations/${donationId}`
            : 'https://man-m681.onrender.com/donations/';
            
        const method = isEdit ? 'PUT' : 'POST';

        const response = await fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                donor_name: donorName,
                amount: donationAmount,
                payment_method: paymentMethod,
                date: donationDate,
                project: donationProject,
                notes: donationNotes,
                status: "completed"
            })
        });

        if (!response.ok) {
            throw new Error('Failed to submit donation');
        }

        const data = await response.json();
        
        // Refresh dashboard data
        await loadDashboardSummary();
        
        // Refresh donations table
        await loadDonations();
        
        if (isEdit) {
            // Update existing receipt
            const receiptElement = document.getElementById(`receipt-${donationId}`);
            if (receiptElement) {
                receiptElement.remove();
            }
        }
        
        // Generate receipt for the new/updated donation
        generateReceipt(data);
        
        // Show success message
        alert(`Donation ${isEdit ? 'updated' : 'submitted'} successfully!`);
        closeDonationModal();
        document.getElementById('donationForm').reset();
        
    } catch (error) {
        console.error('Error submitting donation:', error);
        alert(`Failed to ${isEdit ? 'update' : 'submit'} donation. Please try again.`);
    } finally {
        // Restore button state
        const submitBtn = document.querySelector('#addDonationModal .modal-footer .file-manager-btn');
        submitBtn.innerHTML = isEdit ? 'Update Donation' : 'Save Donation';
        submitBtn.disabled = false;
    }
}
        
function generateReceipt(donation) {
    // Create receipt HTML with the enhanced format
    const receiptHTML = `
        <div class="receipt-card" id="receipt-${donation.id}">
            <div class="receipt-header">
                <div class="receipt-org-info">
                    <img src="logo.jpg" alt="RCDNET Logo" class="receipt-logo">
                    <h2>RWENZORI COMMUNITY DEVELOPMENT NETWORK (RCDNET)</h2>
                </div>
                <div class="receipt-title">
                    <h3>DONATION CONFIRMATION</h3>
                    <p>Receipt issued at RCDNET</p>
                    <p>P.O.Box 558, Kasese, Western Uganda</p>
                    <p>Tax ID No. 1027222682</p>
                    <p>Registration No: 808593</p>
                    <p>Community Registration No. CE/CBS/008</p>
                </div>
            </div>
            
            <div class="receipt-body">
                <div class="receipt-donor-info">
                    <div class="receipt-row">
                        <span class="receipt-label">To:</span>
                        <span class="receipt-value">${donation.donor_name}</span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">Date:</span>
                        <span class="receipt-value">${new Date(donation.date).toLocaleDateString()}</span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">Amount:</span>
                        <span class="receipt-value">UGX ${donation.amount.toLocaleString()}</span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">Payment Method:</span>
                        <span class="receipt-value">${donation.payment_method}</span>
                    </div>
                    <div class="receipt-row">
                        <span class="receipt-label">Program Supported:</span>
                        <span class="receipt-value">${donation.project || 'General Fund'}</span>
                    </div>
                </div>
                
                <div class="receipt-message">
                    <p>Dear ${donation.donor_name},</p>
                    <p>RCDNET confirms your donation of UGX ${donation.amount.toLocaleString()} on ${new Date(donation.date).toLocaleDateString()} at ${new Date().toLocaleTimeString()}. Thank you so much for caring about ${donation.project.toLocaleString()}. We are deeply grateful for your generous gift.</p>
                    
                    <div class="receipt-contact-info">
                        <p>For enquiries call +256 704240309 or email to info@rwenzori-development.org</p>
                        <p>Website: www.rwenzori-development.org</p>
                        <p>YouTube: https://youtube.com/@rwenzoricommunitydevelopme7810?si=zYLqI2Iajh0iQuAq</p>
                        <p>Instagram: https://www.instagram.com/rwenzoridevelopment_rcdnet</p>
                        <p>Facebook: https://www.facebook.com/profile.php?id=100066779636297</p>
                    </div>
                </div>
                
                <div class="receipt-footer">
                    <p>This receipt serves as official confirmation of your donation to RCDNET.</p>
                    <p>Thank you for your support!</p>
                </div>
            </div>
            
            <div class="receipt-actions">
                <button class="file-manager-btn" onclick="downloadReceipt(${donation.id})">
                    <i class="fas fa-download"></i> Download PDF
                </button>
                <button class="file-manager-btn secondary" onclick="emailReceipt(${donation.id})">
                    <i class="fas fa-envelope"></i> Email Receipt
                </button>
                <button class="file-manager-btn secondary" onclick="printReceipt(${donation.id})">
                    <i class="fas fa-print"></i> Print Receipt
                </button>
            </div>
        </div>
    `;

    // Add receipt to the receipts grid
    const receiptsGrid = document.querySelector('.receipts-grid');
    if (receiptsGrid) {
        receiptsGrid.insertAdjacentHTML('afterbegin', receiptHTML);
    }
}


function downloadReceipt(donationId) {
    const receiptElement = document.getElementById(`receipt-${donationId}`);
    if (!receiptElement) {
        alert('Receipt not found');
        return;
    }

    // Create a clone of the receipt element to avoid modifying the original
    const receiptClone = receiptElement.cloneNode(true);
    
    // Remove the action buttons from the clone
    const actions = receiptClone.querySelector('.receipt-actions');
    if (actions) actions.remove();

    // Options for PDF generation
    const opt = {
        margin: [10, 10, 10, 10], // [top, left, bottom, right]
        filename: `RCDNET_Donation_Receipt_${donation.donor_name}.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { 
            scale: 2, // Increase scale for better quality
            logging: true,
            useCORS: true,
            scrollY: 0, // Important to start from top
            windowHeight: receiptClone.scrollHeight // Set window height to content height
        },
        jsPDF: { 
            unit: 'mm', 
            format: 'a4', 
            orientation: 'portrait',
            hotfixes: ["px_scaling"] 
        }
    };

    // Generate PDF
    html2pdf().set(opt).from(receiptClone).save();
}
            
// Add this function to load donations
async function loadDonations() {
    try {
        const donationsTable = document.querySelector('.donations-table tbody');
        donationsTable.innerHTML = '<tr><td colspan="7" style="text-align: center;">Loading donations...</td></tr>';
        
        const response = await fetch('https://man-m681.onrender.com/donations/');
        
        if (!response.ok) {
            throw new Error('Failed to fetch donations');
        }
        
        const data = await response.json();
        donationsTable.innerHTML = '';
        
        // Sort donations by date (newest first)
        data.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        // Display only the most recent donations (e.g., last 10)
        const recentDonations = data.slice(0, 10);
        
        recentDonations.forEach(donation => {
            const row = document.createElement('tr');
            row.setAttribute('data-donation-id', donation.id);
            row.innerHTML = `
                <td>${new Date(donation.date).toLocaleDateString()}</td>
                <td>${donation.donor_name}</td>
                <td>UGX ${donation.amount.toLocaleString()}</td>
                <td>${formatPaymentMethod(donation.payment_method)}</td>
                <td>${donation.project || 'General Fund'}</td>
                <td><span class="status-badge completed">Completed</span></td>
                <td>
                    <button class="action-btn view-btn" onclick="viewDonation(${donation.id})"><i class="fas fa-eye"></i></button>
                    <button class="action-btn edit-btn" onclick="editDonation(${donation.id})"><i class="fas fa-edit"></i></button>
                    <button class="action-btn delete-btn" onclick="deleteDonation(${donation.id})"><i class="fas fa-trash"></i></button>
                </td>
            `;
            donationsTable.appendChild(row);
        });
    } catch (error) {
        console.error('Error loading donations:', error);
        donationsTable.innerHTML = '<tr><td colspan="7" style="text-align: center; color: red;">Failed to load donations</td></tr>';
    }
}

// Helper function to format payment method
function formatPaymentMethod(method) {
    if (!method) return 'Not specified';
    
    const methodMap = {
        'mobile_money': 'Mobile Money',
        'bank_transfer': 'Bank Transfer',
        'western_union': 'Western Union',
        'paypal': 'PayPal',
        'cash': 'Cash',
        'other': 'Other'
    };
    
    // Convert to lowercase and replace underscores for matching
    const normalizedMethod = method.toLowerCase().replace(/\s+/g, '_');
    return methodMap[normalizedMethod] || method;
}
        
// Add these functions for CRUD operations
async function viewDonation(donationId) {
    // Implement view functionality
    alert(`View donation ${donationId}`);
}

async function editDonation(donationId) {
    // Implement edit functionality
    alert(`Edit donation ${donationId}`);
}

async function deleteDonation(donationId) {
    if (confirm('Are you sure you want to delete this donation record?')) {
        try {
            const response = await fetch(`https://man-m681.onrender.com/donations/${donationId}`, {
                method: 'DELETE'
            });
            
            if (!response.ok) {
                throw new Error('Failed to delete donation');
            }
            
            alert('Donation deleted successfully');
            loadDonations();
        } catch (error) {
            console.error('Error deleting donation:', error);
            alert('Failed to delete donation. Please try again.');
        }
    }
}
        // Tab switching functionality
function setupTabSwitching() {
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');

    tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            // Remove active class from all buttons and contents
            tabBtns.forEach(b => b.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            // Add active class to clicked button and corresponding content
            this.classList.add('active');
            const tabId = this.getAttribute('data-tab');
            document.getElementById(tabId).classList.add('active');

            // Load content for the active tab
            switch(tabId) {
                case 'donationHistory':
                    loadDonations();
                    break;
                case 'receipts':
                    loadReceipts();
                    break;
                case 'donorProfiles':
                    loadDonorProfiles();
                    break;
            }
        });
    });
}
async function loadReceipts() {
    try {
        const response = await fetch('https://man-m681.onrender.com/donations/');
        if (!response.ok) throw new Error('Failed to fetch donations');
        
        const donations = await response.json();
        const receiptsGrid = document.getElementById('receiptsGrid');
        receiptsGrid.innerHTML = '';
        
        // Sort donations by date (newest first)
        donations.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        // Generate receipts for all donations
        donations.forEach(donation => {
            generateReceipt(donation);
        });
        
        if (donations.length === 0) {
            receiptsGrid.innerHTML = '<p class="no-receipts">No receipts available. Add a donation to generate receipts.</p>';
        }
    } catch (error) {
        console.error('Error loading receipts:', error);
        document.getElementById('receiptsGrid').innerHTML = 
            '<p class="error">Failed to load receipts. Please try again.</p>';
    }
}

// Call this function when the donations content is shown
// Update your showDonationsContent function
function showDonationsContent() {
    dashboardContent.style.display = 'none';
    fileManagerContent.style.display = 'none';
    donationsContent.style.display = 'block';
    setActiveNavItem(donationsLink);
    
    // Always load donations when showing this content
    loadDonations();
    
    // Set the first tab as active
    const firstTabBtn = document.querySelector('.donations-tabs .tab-btn');
    firstTabBtn.classList.add('active');
    document.getElementById('donationHistory').classList.add('active');
}

// Update your DOMContentLoaded event listener
document.addEventListener('DOMContentLoaded', function() {
    setupTabSwitching();
    
    // Check if we're on the donations page (either by default or via URL hash)
    if (window.location.hash === '#donations' || donationsContent.style.display === 'block') {
        showDonationsContent();
    }
});

// Initialize tab switching when the page loads
document.addEventListener('DOMContentLoaded', function() {
    setupTabSwitching();
    
    // If donations content is shown by default (e.g., from URL hash)
    if (window.location.hash === '#donations') {
        showDonationsContent();
    }
});
        window.submitDonation = submitDonation;
window.viewDonation = viewDonation;
window.editDonation = editDonation;
window.deleteDonation = deleteDonation;

        // Add these to your existing JavaScript

// Global variable to track current donor
let currentDonorId = null;

// Function to open donor modal
function openDonorModal(donorId = null) {
    currentDonorId = donorId;
    const modal = document.getElementById('donorModal');
    const title = document.getElementById('donorModalTitle');
    const saveBtn = document.getElementById('saveDonorBtn');
    
    if (donorId) {
        title.textContent = 'Edit Donor Profile';
        saveBtn.textContent = 'Update Donor';
        loadDonorData(donorId);
    } else {
        title.textContent = 'Add New Donor';
        saveBtn.textContent = 'Add Donor';
        document.getElementById('donorForm').reset();
        document.getElementById('donorDonationsTable').querySelector('tbody').innerHTML = 
            '<tr><td colspan="4" style="text-align: center;">No donation history available</td></tr>';
        document.getElementById('totalDonations').textContent = 'UGX 0';
        document.getElementById('donationCount').textContent = '0';
        document.getElementById('firstDonation').textContent = '-';
        document.getElementById('lastDonation').textContent = '-';
    }
    
    modal.classList.add('show');
}


// Function to close donor modal
function closeDonorModal() {
    document.getElementById('donorModal').classList.remove('show');
    currentDonorId = null;
}

// Function to load donor data
async function loadDonorData(donorId) {
    try {
        const response = await fetch(`https://man-m681.onrender.com/donors/${donorId}`);
        
        if (!response.ok) {
            const error = await response.json();
            throw new Error(error.detail || 'Failed to fetch donor data');
        }
        
        const donor = await response.json();
        
        // Populate form
        document.getElementById('donorId').value = donor.id;
        document.getElementById('donorProfileName').value = donor.name;
        document.getElementById('donorEmail').value = donor.email || '';
        document.getElementById('donorPhone').value = donor.phone || '';
        document.getElementById('donorAddress').value = donor.address || '';
        document.getElementById('donorType').value = donor.donor_type || 'individual';
        document.getElementById('donorCategory').value = donor.category || 'one-time';
        document.getElementById('donorNotes').value = donor.notes || '';
        
        // Load donation history
        loadDonorDonations(donorId);
    } catch (error) {
        console.error('Error loading donor data:', error);
        alert(`Failed to load donor data: ${error.message}`);
    }
}

// Function to load donor's donations
async function loadDonorDonations(donorId) {
    try {
        const response = await fetch(`https://man-m681.onrender.com/donors/${donorId}/donations`);
        if (!response.ok) throw new Error('Failed to fetch donor donations');
        
        const data = await response.json();
        const tbody = document.getElementById('donorDonationsTable').querySelector('tbody');
        tbody.innerHTML = '';
        
        if (data.donations.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">No donation history available</td></tr>';
        } else {
            data.donations.forEach(donation => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${donation.date}</td>
                    <td>UGX ${donation.amount.toLocaleString()}</td>
                    <td>${donation.project}</td>
                    <td><span class="status-badge completed">${donation.status}</span></td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Update stats
        document.getElementById('totalDonations').textContent = `UGX ${data.total_donations.toLocaleString()}`;
        document.getElementById('donationCount').textContent = data.donation_count;
        
        if (data.donations.length > 0) {
            const dates = data.donations.map(d => new Date(d.date));
            dates.sort((a, b) => a - b);
            document.getElementById('firstDonation').textContent = dates[0].toLocaleDateString();
            document.getElementById('lastDonation').textContent = dates[dates.length - 1].toLocaleDateString();
        } else {
            document.getElementById('firstDonation').textContent = '-';
            document.getElementById('lastDonation').textContent = '-';
        }
    } catch (error) {
        console.error('Error loading donor donations:', error);
        alert('Failed to load donation history. Please try again.');
    }
}

// Function to save donor
async function saveDonor() {
    // Validate form before proceeding
    if (!validateDonorForm()) {
        return;
    }
    
    // Get form data
    const donorData = {
        name: document.getElementById('donorProfileName').value.trim(),
        email: document.getElementById('donorEmail').value.trim(),
        phone: document.getElementById('donorPhone').value.trim(),
        address: document.getElementById('donorAddress').value.trim(),
        donor_type: document.getElementById('donorType').value,
        category: document.getElementById('donorCategory').value,
        notes: document.getElementById('donorNotes').value.trim()
    };
    
    try {
        const isEdit = !!currentDonorId;
        const url = isEdit 
            ? `https://man-m681.onrender.com/donors/${currentDonorId}`
            : 'https://man-m681.onrender.com/donors/';
        const method = isEdit ? 'PUT' : 'POST';
        
        // Show loading state
        const saveBtn = document.getElementById('saveDonorBtn');
        const originalText = saveBtn.innerHTML;
        saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        saveBtn.disabled = true;
        
        const response = await fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(donorData)
        });
        
        if (!response.ok) {
            const error = await response.json();
            throw new Error(error.detail || 'Failed to save donor');
        }
        
        // Success - reload donor list and close modal
        await loadDonorProfiles();
        closeDonorModal();
        
    } catch (error) {
        console.error('Save donor error:', error);
        alert(`Error: ${error.message}`);
    } finally {
        // Restore button state
        const saveBtn = document.getElementById('saveDonorBtn');
        saveBtn.innerHTML = currentDonorId ? 'Update Donor' : 'Add Donor';
        saveBtn.disabled = false;
    }
}
        function validateDonorForm() {
    let isValid = true;
    const nameInput = document.getElementById('donorProfileName');
    const emailInput = document.getElementById('donorEmail');
    const phoneInput = document.getElementById('donorPhone');
    
    // Reset all errors
    document.querySelectorAll('.validation-error').forEach(el => {
        el.style.display = 'none';
    });
    document.querySelectorAll('.form-group input, .form-group select, .form-group textarea').forEach(el => {
        el.style.borderColor = '';
    });

    // Validate name (required)
    if (!nameInput.value.trim()) {
        document.getElementById('nameError').style.display = 'block';
        nameInput.style.borderColor = 'red';
        isValid = false;
    }

    // Validate email format if provided
    if (emailInput.value.trim() && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailInput.value)) {
        document.getElementById('emailError').textContent = 'Please enter a valid email address';
        document.getElementById('emailError').style.display = 'block';
        emailInput.style.borderColor = 'red';
        isValid = false;
    }

    // Validate phone format if provided
    if (phoneInput.value.trim() && !/^[\d\s+-]+$/.test(phoneInput.value)) {
        document.getElementById('phoneError').textContent = 'Please enter a valid phone number';
        document.getElementById('phoneError').style.display = 'block';
        phoneInput.style.borderColor = 'red';
        isValid = false;
    }

    if (!isValid) {
        // Focus on first invalid field
        const firstInvalid = document.querySelector('.validation-error[style*="display: block"]');
        if (firstInvalid) {
            firstInvalid.previousElementSibling.focus();
        }
    }

    return isValid;
}
        

// Add event listener in your DOMContentLoaded
document.getElementById('donorForm').addEventListener('submit', function(e) {
    e.preventDefault();
    saveDonor();
});

// Update your save button to trigger form submission
document.getElementById('saveDonorBtn').addEventListener('click', function(e) {
    e.preventDefault();
    document.getElementById('donorForm').dispatchEvent(new Event('submit'));
});

// Update the loadDonorProfiles function to prevent duplicates
async function loadDonorProfiles(search = '') {
    try {
        const container = document.querySelector('.donor-cards');
        container.innerHTML = '<div class="loading">Loading donors...</div>';
        
        const response = await fetch(`https://man-m681.onrender.com/donors/?search=${encodeURIComponent(search)}`);
        
        if (!response.ok) {
            throw new Error('Failed to fetch donors');
        }
        
        const donors = await response.json();
        container.innerHTML = '';
        
        if (donors.length === 0) {
            container.innerHTML = '<p>No donors found. Add a new donor to get started.</p>';
            return;
        }
        
        donors.forEach(donor => {
            const donorCard = document.createElement('div');
            donorCard.className = 'donor-card';
            donorCard.innerHTML = `
                <div class="donor-avatar">
                    <i class="fas ${donor.donor_type === 'corporate' ? 'fa-building' : 'fa-user'}"></i>
                </div>
                <div class="donor-info">
                    <h3 class="donor-name">${donor.name}</h3>
                    <div class="donor-contact">
                        ${donor.email ? `<span><i class="fas fa-envelope"></i> ${donor.email}</span>` : ''}
                        ${donor.phone ? `<span><i class="fas fa-phone"></i> ${donor.phone}</span>` : ''}
                    </div>
                    <div class="donor-stats">
                        <div class="stat-item">
                            <span class="stat-label">Total Donations:</span>
                            <span class="stat-value">UGX ${donor.stats.total_donated.toLocaleString()}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Donation Count:</span>
                            <span class="stat-value">${donor.stats.donation_count}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">First Donation:</span>
                            <span class="stat-value">${donor.stats.first_donation ? new Date(donor.stats.first_donation).toLocaleDateString() : '-'}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Last Donation:</span>
                            <span class="stat-value">${donor.stats.last_donation ? new Date(donor.stats.last_donation).toLocaleDateString() : '-'}</span>
                        </div>
                    </div>
                </div>
                <div class="donor-actions">
                    <button class="file-manager-btn secondary" onclick="openDonorModal(${donor.id})">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="file-manager-btn" onclick="viewDonorHistory(${donor.id})">
                        <i class="fas fa-history"></i> View History
                    </button>
                    <button class="file-manager-btn delete-btn" onclick="deleteDonor(${donor.id})">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            `;
            container.appendChild(donorCard);
        });
    } catch (error) {
        console.error('Error loading donors:', error);
        document.querySelector('.donor-cards').innerHTML = 
            `<p class="error">Failed to load donors: ${error.message}</p>`;
    }
}
        
async function loadDonorData(donorId) {
    try {
        const response = await fetch(`https://man-m681.onrender.com/donors/${donorId}`);
        
        if (!response.ok) {
            const error = await response.json();
            throw new Error(error.detail || 'Failed to fetch donor data');
        }
        
        const donor = await response.json();
        
        // Populate form
        document.getElementById('donorId').value = donor.id;
        document.getElementById('donorProfileName').value = donor.name;
        document.getElementById('donorEmail').value = donor.email || '';
        document.getElementById('donorPhone').value = donor.phone || '';
        document.getElementById('donorAddress').value = donor.address || '';
        document.getElementById('donorType').value = donor.donor_type || 'individual';
        document.getElementById('donorCategory').value = donor.category || 'one-time';
        document.getElementById('donorNotes').value = donor.notes || '';
        
        // Update stats in the modal
        document.getElementById('totalDonations').textContent = `UGX ${donor.stats.total_donated.toLocaleString()}`;
        document.getElementById('donationCount').textContent = donor.stats.donation_count;
        document.getElementById('firstDonation').textContent = donor.stats.first_donation ? 
            new Date(donor.stats.first_donation).toLocaleDateString() : '-';
        document.getElementById('lastDonation').textContent = donor.stats.last_donation ? 
            new Date(donor.stats.last_donation).toLocaleDateString() : '-';
        
        // Load donation history
        loadDonorDonations(donorId);
    } catch (error) {
        console.error('Error loading donor data:', error);
        alert(`Failed to load donor data: ${error.message}`);
    }
}
        
// Add the deleteDonor function
async function deleteDonor(donorId) {
    if (!confirm('Are you sure you want to delete this donor? This action cannot be undone.')) {
        return;
    }
    
    try {
        const response = await fetch(`https://man-m681.onrender.com/donors/${donorId}`, {
            method: 'DELETE'
        });
        
        if (!response.ok) throw new Error('Failed to delete donor');
        
        alert('Donor deleted successfully');
        loadDonorProfiles();
    } catch (error) {
        console.error('Error deleting donor:', error);
        alert('Failed to delete donor. Please try again.');
    }
}

// Function to view donor history (opens modal with donations)
function viewDonorHistory(donorId) {
    currentDonorId = donorId;
    openDonorModal(donorId);
}

// Function to delete donor
async function deleteDonor(donorId) {
    if (!confirm('Are you sure you want to delete this donor? This action cannot be undone.')) {
        return;
    }
    
    try {
        const response = await fetch(`https://man-m681.onrender.com/donors/${donorId}`, {
            method: 'DELETE'
        });
        
        if (!response.ok) throw new Error('Failed to delete donor');
        
        alert('Donor deleted successfully');
        loadDonorProfiles();
    } catch (error) {
        console.error('Error deleting donor:', error);
        alert('Failed to delete donor. Please try again.');
    }
}

// Initialize donor functionality when donations tab is shown
function showDonationsContent() {
    dashboardContent.style.display = 'none';
    fileManagerContent.style.display = 'none';
    donationsContent.style.display = 'block';
    setActiveNavItem(donationsLink);
    
    // Load donations when showing this content
    loadDonations();
    
    // Set the first tab as active
    const firstTabBtn = document.querySelector('.donations-tabs .tab-btn');
    firstTabBtn.classList.add('active');
    document.getElementById('donationHistory').classList.add('active');
    
    // Load donor profiles if on donor tab
    if (document.getElementById('donorProfiles').classList.contains('active')) {
        loadDonorProfiles();
    }
}

// Update tab switching to load appropriate content
function setupTabSwitching() {
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');

    tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            // Remove active class from all buttons and contents
            tabBtns.forEach(b => b.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            // Add active class to clicked button and corresponding content
            this.classList.add('active');
            const tabId = this.getAttribute('data-tab');
            document.getElementById(tabId).classList.add('active');

            // Load content for the active tab
            switch(tabId) {
                case 'donationHistory':
                    loadDonations();
                    break;
                case 'receipts':
                    // You can add a loadReceipts() function later
                    break;
                case 'donorProfiles':
                    loadDonorProfiles();
                    break;
            }
        });
    });
}

// Add event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Add donor button
    document.getElementById('addDonorBtn').addEventListener('click', function() {
        openDonorModal();
    });
    
    // Save donor form submission
    document.getElementById('donorForm').addEventListener('submit', function(e) {
        e.preventDefault();
        saveDonor();
    });
    
    // Initialize tab switching
    setupTabSwitching();
    
    // Load donor profiles if on donor tab
    if (document.getElementById('donorProfiles').classList.contains('active')) {
        loadDonorProfiles();
    }
});
        

// Expose functions to global scope
window.openDonorModal = openDonorModal;
window.closeDonorModal = closeDonorModal;
window.viewDonorHistory = viewDonorHistory;
window.saveDonor = saveDonor;
window.deleteDonor = deleteDonor       
window.downloadDonationHistory = downloadDonationHistory;
        
        async function populateDonorDropdown() {
    try {
        const response = await fetch('https://man-m681.onrender.com/donors/');
        if (!response.ok) throw new Error('Failed to fetch donors');
        
        const donors = await response.json();
        const donorNameInput = document.getElementById('donorName');
        
        // Convert to datalist for autocomplete
        if (!document.getElementById('donorNamesList')) {
            const datalist = document.createElement('datalist');
            datalist.id = 'donorNamesList';
            donorNameInput.setAttribute('list', 'donorNamesList');
            document.body.appendChild(datalist);
        }
        
        const datalist = document.getElementById('donorNamesList');
        datalist.innerHTML = '';
        
        donors.forEach(donor => {
            const option = document.createElement('option');
            option.value = donor.name;
            datalist.appendChild(option);
        });
    } catch (error) {
        console.error('Error populating donor dropdown:', error);
    }
}

// Call this when the add donation modal opens
document.getElementById('addDonationBtn').addEventListener('click', function() {
    addDonationModal.classList.add('show');
    populateDonorDropdown();
});
        // Function to load donation history for a donor
async function loadDonationHistory(donorId) {
    try {
        const [donorResponse, historyResponse] = await Promise.all([
            fetch(`https://man-m681.onrender.com/donors/${donorId}`),
            fetch(`https://man-m681.onrender.com/donors/${donorId}/donations`)
        ]);

        if (!donorResponse.ok || !historyResponse.ok) {
            throw new Error('Failed to fetch donor data');
        }

        const donor = await donorResponse.json();
        const history = await historyResponse.json();

        // Update donor details
        document.getElementById('historyProjectName').textContent = 
            history.donations[0]?.project || 'Various Projects';
        document.getElementById('historyDonorCategory').textContent = 
            donor.category || 'Regular Donor';
        document.getElementById('historyDonorAddress').textContent = 
            donor.address || 'Not specified';
        document.getElementById('historyDonorId').textContent = donor.id;
        
        // Calculate time period
        if (history.donations.length > 0) {
            const dates = history.donations.map(d => new Date(d.date));
            dates.sort((a, b) => a - b);
            const firstDate = dates[0].toLocaleDateString();
            const lastDate = dates[dates.length - 1].toLocaleDateString();
            document.getElementById('historyTimePeriod').textContent = 
                `${firstDate} - ${lastDate}`;
        } else {
            document.getElementById('historyTimePeriod').textContent = 'No donations yet';
        }

        // Populate donation history table
        const tbody = document.getElementById('donationHistoryTableBody');
        tbody.innerHTML = '';
        
        let totalAmount = 0;
        
        history.donations.forEach(donation => {
            totalAmount += donation.amount;
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${new Date(donation.date).toLocaleDateString()}</td>
                <td class="amount-cell">${donation.amount.toLocaleString()}</td>
                <td>${formatPaymentMethod(donation.payment_method)}</td>
                <td>${donation.project || 'General Fund'}</td>
                <td>${donation.status || 'Completed'}</td>
            `;
            tbody.appendChild(row);
        });

        // Update totals
        document.getElementById('historyTotalAmount').textContent = 
            totalAmount.toLocaleString();
        document.getElementById('historyTableTotal').textContent = 
            `UGX ${totalAmount.toLocaleString()}`;
        
        return { donor, history };
    } catch (error) {
        console.error('Error loading donation history:', error);
        alert('Failed to load donation history. Please try again.');
    }
}

// Helper function to format payment method
function formatPaymentMethod(method) {
    if (!method) return 'Not specified';
    
    const methodMap = {
        'mobile_money': 'Mobile Money',
        'bank_transfer': 'Bank Transfer',
        'paypal': 'PayPal',
        'cash': 'Cash',
        'other': 'Other'
    };
    
    return methodMap[method.toLowerCase()] || method;
}

// Function to generate and download donation history PDF
async function downloadDonationHistory(donorId) {
    try {
        const btn = document.getElementById('downloadHistoryBtn');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
        btn.disabled = true;

        // Load the latest data
        const { donor, history } = await loadDonationHistory(donorId);
        
        // Create a printable element
        const element = document.createElement('div');
        element.innerHTML = `
            <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                h1 { color: #3498db; text-align: center; margin-bottom: 20px; }
                .donor-info { margin-bottom: 30px; }
                .info-grid { 
                    display: grid;
                    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                    gap: 15px;
                    margin-bottom: 20px;
                }
                .info-box { 
                    padding: 12px 15px;
                    border-left: 3px solid #3498db;
                    background: #f9f9f9;
                    border-radius: 4px;
                }
                .info-label { 
                    font-weight: bold; 
                    color: #555; 
                    font-size: 0.9em;
                    margin-bottom: 5px;
                }
                .info-value { font-size: 1em; }
                table { 
                    width: 100%; 
                    border-collapse: collapse;
                    margin: 20px 0;
                }
                .info-value{
                    font-family: 'Courier New', monospace;
                    font-weight: bold; 
                }
                th { 
                    background-color: #f8f9fa; 
                    text-align: left; 
                    padding: 10px;
                    color: #555;
                    border-bottom: 2px solid #eee;
                }
                td { 
                    padding: 10px; 
                    border-bottom: 1px solid #f0f0f0; 
                }
                .total-row { 
                    font-weight: bold; 
                    background-color: #f1f8fe; 
                }
                .amount-cell { text-align: center; }
                .footer { 
                    margin-top: 30px; 
                    text-align: right; 
                    font-size: 0.8em;
                    color: #777;
                    padding-right: 22px;
                }
                .logo-header {
                    display: flex;
                    align-items: center;
                    margin-bottom: 20px;
                }
                .logo-header img {
                    height: 50px;
                    margin-right: 15px;
                }
            </style>
            <div class="logo-header">
                <img src="logo.jpg" alt="Rwenzori Community Development Network">
                <div>
                    <h2>Rwenzori Community Development Network</h2>
                    <p>Donation History Report</p>
                </div>
            </div>
            
            <div class="donor-info">
                <h3>Donor Information</h3>
                <div class="info-grid">
                    <div class="info-box">
                        <div class="info-label">Donor Name</div>
                        <div class="info-value">${donor.name}</div>
                    </div>
                    <div class="info-box">
                        <div class="info-label">Donor ID</div>
                        <div class="info-value">${donor.id}</div>
                    </div>
                    <div class="info-box">
                        <div class="info-label">Donor Category</div>
                        <div class="info-value">${donor.category || 'Not specified'}</div>
                    </div>
                    <div class="info-box">
                        <div class="info-label">Address</div>
                        <div class="info-value">${donor.address || 'Not specified'}</div>
                    </div>
                    <div class="info-box">
                        <div class="info-label">Time Period</div>
                        <div class="info-value">${document.getElementById('historyTimePeriod').textContent}</div>
                    </div>
                    <div class="info-box">
                        <div class="info-label">Total Donations</div>
                        <div class="info-value">UGX ${history.donations.reduce((sum, d) => sum + d.amount, 0).toLocaleString()}</div>
                    </div>
                </div>
            </div>
            
            <h3>Donation History</h3>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Amount (UGX)</th>
                        <th>Payment Method</th>
                        <th colspan="2">Project Name</th>
                    </tr>
                </thead>
                <tbody>
                    ${history.donations.map(donation => `
                        <tr>
                            <td>${new Date(donation.date).toLocaleDateString()}</td>
                            <td class="amount-cell">${donation.amount.toLocaleString()}</td>
                            <td>${donation.payment_method || 'Not specified'}</td>
                            <td colspan="2">${donation.project || 'General Fund'}</td>
                        </tr>
                    `).join('')}
                </tbody>
                <tfoot>
                    <tr class="total-row">
                        <td colspan="4">Total</td>
                        <td class="amount-cell">UGX ${history.donations.reduce((sum, d) => sum + d.amount, 0).toLocaleString()}</td>
                    </tr>
                </tfoot>
            </table>
            
            <div class="footer">
                Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
            </div>
            <center><h2>Thank you, We are deeply grateful for your generous gift.</h2></center>
            <br>
            <center><p>For enquiries call +256 704240309 or email to info@rwenzori-development.org</p></center>
            <center><p>Website: www.rwenzori-development.org</p></center>

        `;

        // PDF generation options
        const opt = {
            margin: 10,
            filename: `Donation_History_${donor.name.replace(/\s+/g, '_')}.pdf`,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };

        // Generate PDF
        await html2pdf().set(opt).from(element).save();

    } catch (error) {
        console.error('Error generating PDF:', error);
        alert('Failed to generate PDF. Please try again.');
    } finally {
        const btn = document.getElementById('downloadHistoryBtn');
        btn.innerHTML = '<i class="fas fa-download"></i> Download PDF';
        btn.disabled = false;
    }
}

// Update your viewDonorHistory function to load the history
function viewDonorHistory(donorId) {
    currentDonorId = donorId;
    openDonorModal(donorId);
    loadDonationHistory(donorId);
}

// Add event listener for the download button
document.getElementById('downloadHistoryBtn').addEventListener('click', function() {
    if (currentDonorId) {
        downloadDonationHistory(currentDonorId);
    } else {
        alert('No donor selected');
    }
});
        async function viewDonation(donationId) {
    try {
        const response = await fetch(`https://man-m681.onrender.com/donations/${donationId}`);
        if (!response.ok) throw new Error('Failed to fetch donation');
        
        const donation = await response.json();
        
        // Create a modal to display donation details
        const modalHTML = `
            <div class="donation-modal show" id="viewDonationModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Donation Details</h3>
                        <button class="close-btn" onclick="closeModal('viewDonationModal')">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="donor-stats">
                            <div class="stat-item">
                                <span class="stat-label">Donor Name:</span>
                                <span class="stat-value">${donation.donor_name}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Amount:</span>
                                <span class="stat-value">UGX ${donation.amount.toLocaleString()}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Date:</span>
                                <span class="stat-value">${new Date(donation.date).toLocaleDateString()}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Payment Method:</span>
                                <span class="stat-value">${formatPaymentMethod(donation.payment_method)}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Project:</span>
                                <span class="stat-value">${donation.project || 'General Fund'}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Status:</span>
                                <span class="stat-value">${donation.status}</span>
                            </div>
                            ${donation.notes ? `
                            <div class="stat-item">
                                <span class="stat-label">Notes:</span>
                                <span class="stat-value">${donation.notes}</span>
                            </div>` : ''}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="file-manager-btn" onclick="editDonation(${donation.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="file-manager-btn secondary" onclick="closeModal('viewDonationModal')">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        // Add modal to DOM
        document.body.insertAdjacentHTML('beforeend', modalHTML);
    } catch (error) {
        console.error('Error viewing donation:', error);
        alert('Failed to view donation details. Please try again.');
    }
}


async function editDonation(donationId) {
    try {
        // Close any open modals
        closeModal('viewDonationModal');
        
        const response = await fetch(`https://man-m681.onrender.com/donations/${donationId}`);
        if (!response.ok) throw new Error('Failed to fetch donation');
        
        const donation = await response.json();
        
        // Populate the donation form with existing data
        document.getElementById('donorName').value = donation.donor_name;
        document.getElementById('donationAmount').value = donation.amount;
        document.getElementById('paymentMethod').value = donation.payment_method;
        document.getElementById('donationDate').value = donation.date.split('T')[0]; // Format date for input
        document.getElementById('donationProject').value = donation.project || '';
        document.getElementById('donationNotes').value = donation.notes || '';
        
        // Change modal title and button text
        document.querySelector('#addDonationModal .modal-header h3').textContent = 'Edit Donation';
        document.querySelector('#addDonationModal .modal-footer .file-manager-btn').textContent = 'Update Donation';
        
        // Store donation ID for update
        document.getElementById('addDonationModal').dataset.donationId = donationId;
        
        // Open modal
        document.getElementById('addDonationModal').classList.add('show');
    } catch (error) {
        console.error('Error editing donation:', error);
        alert('Failed to load donation for editing. Please try again.');
    }
}

async function deleteDonation(donationId) {
    if (!confirm('Are you sure you want to delete this donation record?')) {
        return;
    }
    
    try {
        const response = await fetch(`https://man-m681.onrender.com/donations/${donationId}`, {
            method: 'DELETE'
        });
        
        if (!response.ok) {
            throw new Error('Failed to delete donation');
        }
        
        // Remove the donation row from the table
        document.querySelector(`.donations-table tbody tr[data-donation-id="${donationId}"]`)?.remove();
        
        // Remove the corresponding receipt
        document.getElementById(`receipt-${donationId}`)?.remove();
        
        alert('Donation deleted successfully');
        
        // Refresh the donations list
        loadDonations();
    } catch (error) {
        console.error('Error deleting donation:', error);
        alert('Failed to delete donation. Please try again.');
    }
}

// Helper function to close modal
function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.remove();
    }
}
        
function emailReceipt(donationId) {
  const recipient = "rcdnetciuganda@gmail.com";
  const subject = encodeURIComponent("Donation acknowledgement");
  const body = encodeURIComponent(
    `Dear Donor, we are thrilled to receive your generous support. Your donation has been well received. Kindly find the donation confirmation attached here in.With kind regards. Mrs. Muhindo Justine. Board treasurer`
  );

  const gmailURL = `https://mail.google.com/mail/?view=cm&fs=1&to=${recipient}&su=${subject}&body=${body}`;
  window.open(gmailURL, '_blank'); // Opens in new tab
}
        // Add this to your existing JavaScript

// Implement Project Navigation
document.querySelector('.sidebar-menu a[href="#implementProject"]').addEventListener('click', function(e) {
    e.preventDefault();
    dashboardContent.style.display = 'none';
    fileManagerContent.style.display = 'none';
    donationsContent.style.display = 'none';
    implementProjectContent.style.display = 'block';
    
    // Show role selection by default
    document.getElementById('roleSelection').style.display = 'block';
    document.getElementById('directorDashboard').style.display = 'none';
    
    setActiveNavItem(this);
});

// Role Selection
// Update your selectRole function
function selectRole(role) {
    // Remove active class from all role cards
    document.querySelectorAll('.role-card').forEach(card => {
        card.classList.remove('active');
    });
    
    // Add active class to the selected role card
    event.currentTarget.classList.add('active');
    
    // Hide all dashboards first
    document.getElementById('directorDashboard').style.display = 'none';
    document.getElementById('programOfficerDashboard').style.display = 'none';
    document.getElementById('roleSelection').style.display = 'none';
    
    if (role === 'director') {
        document.getElementById('directorDashboard').style.display = 'block';
        loadProjects();
        
        // Add event listener for create project button
        document.getElementById('createProjectBtn').addEventListener('click', function() {
            document.getElementById('projectForm').reset();
            document.getElementById('createProjectModal').classList.add('show');
        });
    } 
    else if (role === 'program_officer') {
        document.getElementById('programOfficerDashboard').style.display = 'block';
        loadActivities();
        
        // Add event listener for create activity button
        document.getElementById('createActivityBtn').addEventListener('click', function() {
            document.getElementById('activityForm').reset();
            loadProjectsForActivities();
            document.getElementById('createActivityModal').classList.add('show');
        });
    } 
    else if (role === 'human_resource') {
        // Redirect to HR page
        window.location.href = "https://dariusmumbere.github.io/ngo/roles.html";
    }
    else if (role === 'finance') {
        // Redirect to Finance page
        window.location.href = "https://dariusmumbere.github.io/ngo/finance.html";
    }
    else {
        alert(`${role.replace('_', ' ').toUpperCase()} functionality will be implemented later`);
    }
}
async function loadProjectsForActivities() {
    try {
        const response = await fetch('https://man-m681.onrender.com/projects/');
        if (!response.ok) throw new Error('Failed to fetch projects');
        
        const data = await response.json();
        const projectSelect = document.getElementById('activityProject');
        projectSelect.innerHTML = '';
        
        data.projects.forEach(project => {
            const option = document.createElement('option');
            option.value = project.id;
            option.textContent = project.name;
            projectSelect.appendChild(option);
        });
    } catch (error) {
        console.error('Error loading projects for activities:', error);
        alert('Failed to load projects for activities dropdown');
    }
}
// Project Management Functions
function loadProjects() {
    fetch('https://man-m681.onrender.com/projects/')
        .then(response => response.json())
        .then(data => {
            const tableBody = document.getElementById('projectsTableBody');
            tableBody.innerHTML = '';
            
            data.projects.forEach(project => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${project.name}</td>
                    <td>${project.start_date}</td>
                    <td>${project.end_date}</td>
                    <td>UGX ${project.budget.toLocaleString()}</td>
                    <td><span class="status-badge ${project.status}">${project.status}</span></td>
                    <td>
                        <button class="action-btn view-btn" onclick="viewProject(${project.id})"><i class="fas fa-eye"></i></button>
                        <button class="action-btn edit-btn" onclick="editProject(${project.id})"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-btn" onclick="deleteProject(${project.id})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        })
        .catch(error => {
            console.error('Error loading projects:', error);
            alert('Failed to load projects');
        });
}
async function loadActivities() {
    try {
        const response = await fetch('https://man-m681.onrender.com/activities/');
        const activities = await response.json();
        
        const tableBody = document.getElementById('activitiesTableBody');
        tableBody.innerHTML = '';
        
        for (const activity of activities) {
            // Get budget status for each activity
            const statusResponse = await fetch(`https://man-m681.onrender.com/activities/${activity.id}/budget-status/`);
            const budgetStatus = await statusResponse.json();
            
            const statusBadge = {
                'approved': 'status-badge approved',
                'rejected': 'status-badge rejected',
                'pending': 'status-badge pending',
                'not_submitted': 'status-badge draft'
            }[budgetStatus.status] || 'status-badge draft';
            
            const statusText = {
                'approved': 'Approved',
                'rejected': 'Rejected',
                'pending': 'Pending Approval',
                'not_submitted': 'Draft'
            }[budgetStatus.status] || 'Draft';
            
            // Add Submit button only if status is draft/not_submitted
            const submitButton = budgetStatus.status === 'not_submitted' ? 
                `<button class="action-btn submit-btn" onclick="submitActivityBudget(${activity.id})">
                    <i class="fas fa-paper-plane"></i> Submit
                </button>` : '';
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${activity.name}</td>
                <td>${activity.project_name}</td>
                <td>${activity.start_date}</td>
                <td>${activity.end_date}</td>
                <td>UGX ${activity.budget.toLocaleString()}</td>
                <td><span class="${statusBadge}">${statusText}</span></td>
                <td>
                    ${submitButton}
                    <button class="action-btn budget-btn" onclick="manageActivityBudget(${activity.id}, '${activity.name}')">
                        <i class="fas fa-coins"></i> Budget
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        }
    } catch (error) {
        console.error('Error loading activities:', error);
        document.getElementById('activitiesTableBody').innerHTML = `
            <tr>
                <td colspan="7" style="text-align: center; color: red;">
                    Failed to load activities: ${error.message}
                </td>
            </tr>
        `;
    }
}
        
// Create a new activity
async function createActivity() {
    const activityData = {
        name: document.getElementById('activityName').value,
        project_id: document.getElementById('activityProject').value,
        description: document.getElementById('activityDescription').value,
        start_date: document.getElementById('activityStartDate').value,
        end_date: document.getElementById('activityEndDate').value,
        budget: parseFloat(document.getElementById('activityBudget').value),
        status: document.getElementById('activityStatus').value
    };
    
    // Validate required fields
    if (!activityData.name || !activityData.project_id || !activityData.start_date || 
        !activityData.end_date || isNaN(activityData.budget)) {
        alert('Please fill in all required fields with valid values');
        return;
    }
    
    try {
        const submitBtn = document.querySelector('#createActivityModal .modal-footer .file-manager-btn');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        submitBtn.disabled = true;
        
        const response = await fetch('https://man-m681.onrender.com/activities/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(activityData)
        });
        
        if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(errorData.message || 'Failed to create activity');
        }
        
        const data = await response.json();
        alert('Activity created successfully');
        closeModal('createActivityModal');
        
        // Show budget creation modal for the new activity
        showBudgetCreationModal(data.id, data.name);
        
        // Reload activities
        await loadActivities();
        
    } catch (error) {
        console.error('Error creating activity:', error);
        alert(`Failed to create activity: ${error.message}`);
    } finally {
        const submitBtn = document.querySelector('#createActivityModal .modal-footer .file-manager-btn');
        if (submitBtn) {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }
    }
}

function showBudgetCreationModal(activityId, activityName) {
    if (confirm(`Would you like to create a budget for "${activityName}"?`)) {
        // Reset and populate the budget modal
        document.getElementById('budgetItemName').value = '';
        document.getElementById('budgetItemDescription').value = '';
        document.getElementById('budgetItemQuantity').value = '1';
        document.getElementById('budgetItemUnitPrice').value = '';
        document.getElementById('budgetItemCategory').value = 'materials';
        
        // Store the activity ID for the budget creation
        document.getElementById('createBudgetModal').dataset.activityId = activityId;
        document.getElementById('budgetForActivityName').textContent = activityName;
        
        // Show the budget modal
        document.getElementById('createBudgetModal').classList.add('show');
    }
}

async function createBudgetItem() {
    const activityId = document.getElementById('createBudgetModal').dataset.activityId;
    const budgetData = {
        item_name: document.getElementById('budgetItemName').value.trim(),
        description: document.getElementById('budgetItemDescription').value.trim(),
        quantity: parseFloat(document.getElementById('budgetItemQuantity').value),
        unit_price: parseFloat(document.getElementById('budgetItemUnitPrice').value),
        category: document.getElementById('budgetItemCategory').value
    };
    
    // Validate required fields
    if (!budgetData.item_name || isNaN(budgetData.quantity) || isNaN(budgetData.unit_price)) {
        alert('Please fill in all required budget fields with valid values');
        return;
    }
    
    // Additional validation
    if (budgetData.quantity <= 0 || budgetData.unit_price <= 0) {
        alert('Quantity and unit price must be greater than 0');
        return;
    }
    
    try {
        const submitBtn = document.querySelector('#createBudgetModal .modal-footer .file-manager-btn');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        submitBtn.disabled = true;
        
        const response = await fetch(`https://man-m681.onrender.com/activities/${activityId}/budget-items/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(budgetData)
        });
        
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.detail || 'Failed to create budget item');
        }
        
        const data = await response.json();
        alert('Budget item created successfully');
        closeModal('createBudgetModal');
        
    } catch (error) {
        console.error('Error creating budget item:', error);
        alert(`Failed to create budget item: ${error.message}`);
    } finally {
        const submitBtn = document.querySelector('#createBudgetModal .modal-footer .file-manager-btn');
        if (submitBtn) {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }
    }
}
// View activity details
async function viewActivity(activityId) {
    try {
        const response = await fetch(`https://man-m681.onrender.com/activities/${activityId}`);
        if (!response.ok) throw new Error('Failed to fetch activity');
        
        const activity = await response.json();
        
        alert(`Activity Details:\nName: ${activity.name}\nProject: ${activity.project_name}\nStatus: ${activity.status}`);
    } catch (error) {
        console.error('Error viewing activity:', error);
        alert('Failed to view activity details');
    }
}

// Edit activity
async function editActivity(activityId) {
    try {
        const response = await fetch(`https://man-m681.onrender.com/activities/${activityId}`);
        if (!response.ok) throw new Error('Failed to fetch activity');
        
        const activity = await response.json();
        
        // Populate the activity form with existing data
        document.getElementById('activityName').value = activity.name;
        document.getElementById('activityDescription').value = activity.description;
        document.getElementById('activityStartDate').value = activity.start_date.split('T')[0];
        document.getElementById('activityEndDate').value = activity.end_date.split('T')[0];
        document.getElementById('activityBudget').value = activity.budget;
        document.getElementById('activityStatus').value = activity.status;
        
        // Load projects and select the current one
        await loadProjectsForActivities();
        document.getElementById('activityProject').value = activity.project_id;
        
        // Change modal title and button text
        document.querySelector('#createActivityModal .modal-header h3').textContent = 'Edit Activity';
        document.querySelector('#createActivityModal .modal-footer .file-manager-btn').textContent = 'Update Activity';
        
        // Store activity ID for update
        document.getElementById('createActivityModal').dataset.activityId = activityId;
        
        // Open modal
        document.getElementById('createActivityModal').classList.add('show');
    } catch (error) {
        console.error('Error editing activity:', error);
        alert('Failed to load activity for editing');
    }
}

// Delete activity
async function deleteActivity(activityId) {
    if (!confirm('Are you sure you want to delete this activity?')) {
        return;
    }
    
    try {
        const response = await fetch(`https://man-m681.onrender.com/activities/${activityId}`, {
            method: 'DELETE'
        });
        
        if (!response.ok) {
            throw new Error('Failed to delete activity');
        }
        
        alert('Activity deleted successfully');
        loadActivities();
    } catch (error) {
        console.error('Error deleting activity:', error);
        alert('Failed to delete activity');
    }
}

async function createProject() {
    const projectData = {
        name: document.getElementById('projectName').value,
        description: document.getElementById('projectDescription').value,
        start_date: document.getElementById('projectStartDate').value,
        end_date: document.getElementById('projectEndDate').value,
        budget: parseFloat(document.getElementById('projectBudget').value),
        funding_source: document.getElementById('projectFunds').value,
        status: 'planned'
    };
    
    // Validate required fields
    if (!projectData.name || !projectData.start_date || !projectData.end_date || !projectData.budget) {
        alert('Please fill in all required fields');
        return;
    }
    
    // Determine if this is for a specific program area
    const programAreaId = document.getElementById('createProjectModal').dataset.programAreaId;
    let url = 'https://man-m681.onrender.com/projects/';
    
    if (programAreaId) {
        url = `https://man-m681.onrender.com/program_areas/${programAreaId}/projects/`;
    }
    
    try {
        const submitBtn = document.querySelector('#createProjectModal .modal-footer .file-manager-btn');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        submitBtn.disabled = true;
        
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(projectData)
        });
        
        if (!response.ok) {
            throw new Error('Failed to create project');
        }
        
        const data = await response.json();
        alert('Project created successfully');
        closeModal('createProjectModal');
        
        // Refresh the appropriate project list
        if (programAreaId) {
            loadProgramAreaProjects(programAreaId);
        } else {
            loadProjects();
        }
    } catch (error) {
        console.error('Error creating project:', error);
        alert('Failed to create project');
    } finally {
        const submitBtn = document.querySelector('#createProjectModal .modal-footer .file-manager-btn');
        if (submitBtn) {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }
    }
}

function viewProject(projectId) {
    fetch(`https://man-m681.onrender.com/projects/${projectId}`)
        .then(response => response.json())
        .then(project => {
            alert(`Project Details:\nName: ${project.name}\nBudget: UGX ${project.budget}\nStatus: ${project.status}`);
        })
        .catch(error => {
            console.error('Error viewing project:', error);
            alert('Failed to view project details');
        });
}

function editProject(projectId) {
    // Similar to create but with existing data
    alert('Edit project functionality will be implemented');
}

function deleteProject(projectId) {
    if (confirm('Are you sure you want to delete this project?')) {
        fetch(`https://man-m681.onrender.com/projects/${projectId}`, {
            method: 'DELETE'
        })
        .then(response => {
            if (response.ok) {
                alert('Project deleted successfully');
                loadProjects();
            } else {
                throw new Error('Failed to delete project');
            }
        })
        .catch(error => {
            console.error('Error deleting project:', error);
            alert('Failed to delete project');
        });
    }
}

// Modal helper functions
function openModal(modalId) {
    document.getElementById(modalId).classList.add('show');
}

function closeModal(modalId) {
    document.getElementById(modalId).classList.remove('show');
}

// Event listeners
document.getElementById('createProjectBtn').addEventListener('click', function() {
    document.getElementById('projectForm').reset();
    openModal('createProjectModal');
});
function updateTableInfo() {
    const totalRows = document.querySelectorAll('#activitiesTableBody tr').length;
    const visibleRows = document.querySelectorAll('#activitiesTableBody tr:not([style*="display: none"])').length;
    
    document.getElementById('showingCount').textContent = visibleRows;
    document.getElementById('totalCount').textContent = totalRows;
}

// Initialize table info
updateTableInfo();
let currentProgramAreaId = null;
let currentProgramAreaName = null;

// Navigation to program area
function navigateToProgramArea(programAreaId, programAreaName) {
    currentProgramAreaId = programAreaId;
    currentProgramAreaName = programAreaName;
    
    // Hide other content
    document.getElementById('dashboardContent').style.display = 'none';
    document.getElementById('fileManagerContent').style.display = 'none';
    document.getElementById('donationsContent').style.display = 'none';
    document.getElementById('implementProjectContent').style.display = 'none';
    
    // Show program area content
    const programAreaContent = document.getElementById('programAreaContent');
    programAreaContent.style.display = 'block';
    
    // Update title
    document.getElementById('programAreaName').textContent = programAreaName;
    
    // Load projects for this program area
    loadProgramAreaProjects(programAreaId);
}

// Load projects for a specific program area
async function loadProgramAreaProjects(programAreaId) {
    try {
        const tableBody = document.getElementById('programAreaProjectsTableBody');
        tableBody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Loading projects...</td></tr>';
        
        const response = await fetch(`https://man-m681.onrender.com/program_areas/${programAreaId}/projects/`);
        
        if (!response.ok) {
            throw new Error('Failed to fetch projects');
        }
        
        const data = await response.json();
        tableBody.innerHTML = '';
        
        if (data.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="6" style="text-align: center;">No projects found for this program area</td></tr>';
            return;
        }
        
        data.forEach(project => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${project.name}</td>
                <td>${project.start_date}</td>
                <td>${project.end_date}</td>
                <td>UGX ${project.budget.toLocaleString()}</td>
                <td><span class="status-badge ${project.status}">${project.status}</span></td>
                <td>
                    <button class="action-btn view-btn" onclick="viewProject(${project.id})">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="action-btn edit-btn" onclick="editProject(${project.id})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn delete-btn" onclick="deleteProject(${project.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
    } catch (error) {
        console.error('Error loading program area projects:', error);
        document.getElementById('programAreaProjectsTableBody').innerHTML = 
            '<tr><td colspan="6" style="text-align: center; color: red;">Failed to load projects</td></tr>';
    }
}

// Add project to program area
document.getElementById('addProjectToProgramBtn').addEventListener('click', function() {
    if (!currentProgramAreaId) return;
    
    // Reset form
    document.getElementById('projectForm').reset();
    
    // Set modal title
    document.querySelector('#createProjectModal .modal-header h3').textContent = 
        `Add Project to ${currentProgramAreaName}`;
    
    // Store that this is for a specific program area
    document.getElementById('createProjectModal').dataset.programAreaId = currentProgramAreaId;
    
    // Open modal
    document.getElementById('createProjectModal').classList.add('show');
});
function initPaymentApprovals() {
    // Load pending payments
    loadPendingPayments();
    
    // Set up filter
    document.getElementById('approvalStatusFilter').addEventListener('change', function() {
        loadPendingPayments();
    });
    
    // Set up refresh button
    document.getElementById('refreshApprovalsBtn').addEventListener('click', function() {
        loadPendingPayments();
    });
    
    // Set up approval/reject buttons
    document.getElementById('approvePaymentBtn').addEventListener('click', function() {
        approvePayment(true);
    });
    
    document.getElementById('rejectPaymentBtn').addEventListener('click', function() {
        approvePayment(false);
    });
    
    // Close modal when clicking outside
    const approvalModal = document.getElementById('approvalActionModal');
    window.addEventListener('click', function(event) {
        if (event.target === approvalModal) {
            approvalModal.style.display = 'none';
        }
    });
}

async function loadPendingPayments() {
    try {
        const tbody = document.getElementById('approvalsTableBody');
        tbody.innerHTML = '<tr><td colspan="7" class="loading"><div class="spinner"></div></td></tr>';
        
        const statusFilter = document.getElementById('approvalStatusFilter').value;
        let url = 'https://man-m681.onrender.com/payments/';
        
        if (statusFilter !== 'all') {
            url = `https://man-m681.onrender.com/payments/?status=${statusFilter}`;
        }
        
        const response = await fetch(url);
        if (!response.ok) throw new Error('Failed to fetch payments for approval');
        
        const payments = await response.json();
        tbody.innerHTML = '';
        
        if (payments.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No payments found</td></tr>';
            return;
        }
        
        payments.forEach(payment => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${payment.employee_name}</td>
                <td>UGX ${payment.amount.toLocaleString()}</td>
                <td>${payment.payment_period}</td>
                <td>${payment.description || '-'}</td>
                <td><span class="status-badge ${payment.status}">${payment.status}</span></td>
                <td>${new Date(payment.created_at).toLocaleDateString()}</td>
                <td>
                    ${payment.status === 'pending' ? `
                    <button class="action-btn edit-btn" onclick="openApprovalModal(${payment.id})">
                        <i class="fas fa-clipboard-check"></i>
                    </button>
                    ` : `
                    <button class="action-btn view-btn" onclick="viewPaymentDetails(${payment.id})">
                        <i class="fas fa-eye"></i>
                    </button>
                    `}
                </td>
            `;
            tbody.appendChild(row);
        });
    } catch (error) {
        console.error('Error loading payments for approval:', error);
        document.getElementById('approvalsTableBody').innerHTML = 
            '<tr><td colspan="7" style="text-align: center; color: red;">Failed to load payments</td></tr>';
    }
}

async function openApprovalModal(paymentId) {
    try {
        const response = await fetch(`https://man-m681.onrender.com/payments/${paymentId}`);
        if (!response.ok) throw new Error('Failed to fetch payment details');
        
        const payment = await response.json();
        
        // Populate modal
        document.getElementById('approvalEmployeeName').textContent = payment.employee_name;
        document.getElementById('approvalAmount').textContent = `UGX ${payment.amount.toLocaleString()}`;
        document.getElementById('approvalPeriod').textContent = payment.payment_period;
        document.getElementById('approvalDescription').textContent = payment.description || '-';
        document.getElementById('approvalRequestDate').textContent = new Date(payment.created_at).toLocaleString();
        document.getElementById('currentPaymentId').value = payment.id;
        
        // Open modal
        document.getElementById('approvalActionModal').style.display = 'block';
    } catch (error) {
        console.error('Error opening approval modal:', error);
        alert('Failed to load payment details for approval');
    }
}

async function approvePayment(approve) {
    const paymentId = document.getElementById('currentPaymentId').value;
    const remarks = document.getElementById('approvalRemarks').value.trim();
    
    if (!paymentId) {
        alert('No payment selected');
        return;
    }
    
    try {
        const btn = approve ? document.getElementById('approvePaymentBtn') : document.getElementById('rejectPaymentBtn');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
        btn.disabled = true;
        
        const response = await fetch('https://man-m681.onrender.com/payments/approve', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                payment_id: parseInt(paymentId),
                approved: approve,
                remarks: remarks
            })
        });
        
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.detail || 'Failed to process approval');
        }
        
        const data = await response.json();
        alert(`Payment ${approve ? 'approved' : 'rejected'} successfully!`);
        
        // Close modal
        document.getElementById('approvalActionModal').style.display = 'none';
        document.getElementById('approvalForm').reset();
        
        // Refresh approvals list
        loadPendingPayments();
    } catch (error) {
        console.error('Error approving payment:', error);
        alert(`Error: ${error.message}`);
    } finally {
        const approveBtn = document.getElementById('approvePaymentBtn');
        const rejectBtn = document.getElementById('rejectPaymentBtn');
        
        if (approveBtn && rejectBtn) {
            approveBtn.innerHTML = '<i class="fas fa-check"></i> Approve';
            approveBtn.disabled = false;
            rejectBtn.innerHTML = '<i class="fas fa-times"></i> Reject';
            rejectBtn.disabled = false;
        }
    }
}

// Common function to view payment details
async function viewPaymentDetails(paymentId) {
    try {
        const response = await fetch(`https://man-m681.onrender.com/payments/${paymentId}`);
        if (!response.ok) throw new Error('Failed to fetch payment details');
        
        const payment = await response.json();
        
        // Create a modal to display payment details
        const modalHTML = `
            <div class="modal show" id="viewPaymentModal">
                <div class="modal-content">
                    <span class="close-btn" onclick="document.getElementById('viewPaymentModal').remove()">&times;</span>
                    <h2><i class="fas fa-money-bill-wave"></i> Payment Details</h2>
                    
                    <div class="payment-details">
                        <div class="detail-row">
                            <span class="detail-label">Employee:</span>
                            <span class="detail-value">${payment.employee_name}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Amount:</span>
                            <span class="detail-value">UGX ${payment.amount.toLocaleString()}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Period:</span>
                            <span class="detail-value">${payment.payment_period}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Description:</span>
                            <span class="detail-value">${payment.description || '-'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Status:</span>
                            <span class="detail-value"><span class="status-badge ${payment.status}">${payment.status}</span></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Request Date:</span>
                            <span class="detail-value">${new Date(payment.created_at).toLocaleString()}</span>
                        </div>
                        ${payment.approved_at ? `
                        <div class="detail-row">
                            <span class="detail-label">${payment.status === 'approved' ? 'Approved' : 'Rejected'} Date:</span>
                            <span class="detail-value">${new Date(payment.approved_at).toLocaleString()}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">${payment.status === 'approved' ? 'Approved' : 'Rejected'} By:</span>
                            <span class="detail-value">${payment.approver_name || 'System'}</span>
                        </div>
                        ` : ''}
                        ${payment.remarks ? `
                        <div class="detail-row">
                            <span class="detail-label">Remarks:</span>
                            <span class="detail-value">${payment.remarks}</span>
                        </div>
                        ` : ''}
                        ${payment.processed_at ? `
                        <div class="detail-row">
                            <span class="detail-label">Processed Date:</span>
                            <span class="detail-value">${new Date(payment.processed_at).toLocaleString()}</span>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="document.getElementById('viewPaymentModal').remove()">
                            Close
                        </button>
                        ${payment.status === 'approved' ? `
                        <button class="btn btn-primary" onclick="processPayment(${payment.id})">
                            <i class="fas fa-check-circle"></i> Mark as Processed
                        </button>
                        ` : ''}
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHTML);
    } catch (error) {
        console.error('Error viewing payment details:', error);
        alert('Failed to load payment details');
    }
}

async function processPayment(paymentId) {
    if (!confirm('Are you sure you want to mark this payment as processed? This will deduct the amount from the bank account.')) {
        return;
    }
    
    try {
        const response = await fetch(`https://man-m681.onrender.com/payments/process/${paymentId}`, {
            method: 'POST'
        });
        
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.detail || 'Failed to process payment');
        }
        
        const data = await response.json();
        alert('Payment marked as processed successfully!');
        
        // Close modal and refresh data
        document.getElementById('viewPaymentModal').remove();
        if (document.getElementById('approvalsTableBody')) {
            loadPendingPayments();
        }
        if (document.getElementById('paymentsTableBody')) {
            loadPaymentHistory();
        }
    } catch (error) {
        console.error('Error processing payment:', error);
        alert(`Error: ${error.message}`);
    }
}     
// Function to load dashboard summary
async function loadDashboardSummary() {
    try {
        const response = await fetch('https://man-m681.onrender.com/dashboard-summary/');
        if (!response.ok) throw new Error('Failed to fetch dashboard summary');
        
        const data = await response.json();
        
        // Debug: Log the received data
        console.log('Dashboard data:', data);
        
        // Update main account card
        const mainAccountElement = document.querySelector('.main-bank-card .bank-card-balance');
        if (mainAccountElement) {
            mainAccountElement.textContent = `UGX ${(data.main_account_balance || 0).toLocaleString()}`;
        }
        
        // Update program area cards
        const programCards = {
            'Women Empowerment': document.querySelector('.program-card-1 .bank-card-balance'),
            'Vocational Education': document.querySelector('.program-card-2 .bank-card-balance'),
            'Climate Change': document.querySelector('.program-card-3 .bank-card-balance'),
            'Reproductive Health': document.querySelector('.program-card-4 .bank-card-balance')
        };
        
        for (const [programName, cardElement] of Object.entries(programCards)) {
            if (cardElement) {
                const balance = data.program_balances?.[programName] || 0;
                cardElement.textContent = `UGX ${balance.toLocaleString()}`;
            }
        }
        
        // Update total donations stat card
        const donationStatElement = document.querySelector('.stat-card .stat-value');
        if (donationStatElement) {
            donationStatElement.textContent = `UGX ${(data.total_donations || 0).toLocaleString()}`;
        }
        
    } catch (error) {
        console.error('Error loading dashboard summary:', error);
        // Don't show alert to avoid interrupting user experience
    }
}

async function createBudgetApproval(activityId, activityName) {
    try {
        // First check if there's already an approval request
        const response = await fetch(`https://man-m681.onrender.com/budget-approvals/activity/${activityId}`);
        
        if (response.ok) {
            const existingApproval = await response.json();
            if (existingApproval.status === 'pending') {
                alert(`There's already a pending approval request for "${activityName}"`);
                return;
            }
        }
        
        // Get activity details to know the requested amount
        const activityResponse = await fetch(`https://man-m681.onrender.com/activities/${activityId}`);
        if (!activityResponse.ok) throw new Error('Failed to fetch activity details');
        
        const activity = await activityResponse.json();
        
        // Create approval request
        const approvalResponse = await fetch('https://man-m681.onrender.com/budget-approvals/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                activity_id: activityId,
                approved_amount: activity.budget, // Initially same as requested
                status: 'pending'
            })
        });
        
        if (!approvalResponse.ok) throw new Error('Failed to create approval request');
        
        alert(`Budget approval request for "${activityName}" has been submitted to the Director`);
        
    } catch (error) {
        console.error('Error creating budget approval:', error);
        alert(`Failed to create budget approval: ${error.message}`);
    }
}

// Function to load pending approvals for director dashboard
async function loadPendingApprovals() {
    try {
        const response = await fetch('https://man-m681.onrender.com/budget-approvals/pending');
        if (!response.ok) throw new Error('Failed to fetch pending approvals');
        
        const approvals = await response.json();
        const container = document.getElementById('pendingApprovalsContainer');
        
        if (!container) return; // Only proceed if on director dashboard
        
        container.innerHTML = '';
        
        if (approvals.length === 0) {
            container.innerHTML = '<p>No pending budget approvals</p>';
            return;
        }
        
        approvals.forEach(approval => {
            const approvalCard = document.createElement('div');
            approvalCard.className = 'approval-card';
            approvalCard.innerHTML = `
                <div class="approval-header">
                    <h4>${approval.activity_name}</h4>
                    <span class="status-badge pending">Pending</span>
                </div>
                <div class="approval-details">
                    <p><strong>Project:</strong> ${approval.project_name}</p>
                    <p><strong>Requested Amount:</strong> UGX ${approval.requested_amount.toLocaleString()}</p>
                    <div class="approval-actions">
                        <input type="number" id="approvedAmount-${approval.id}" 
                               value="${approval.requested_amount}" min="0" 
                               step="0.01" placeholder="Approved amount">
                        <textarea id="approvalNotes-${approval.id}" 
                                  placeholder="Approval notes (optional)"></textarea>
                        <button class="file-manager-btn" onclick="approveBudget(${approval.id}, true)">
                            <i class="fas fa-check"></i> Approve
                        </button>
                        <button class="file-manager-btn delete-btn" onclick="approveBudget(${approval.id}, false)">
                            <i class="fas fa-times"></i> Reject
                        </button>
                    </div>
                </div>
            `;
            container.appendChild(approvalCard);
        });
    } catch (error) {
        console.error('Error loading pending approvals:', error);
        const container = document.getElementById('pendingApprovalsContainer');
        if (container) {
            container.innerHTML = `<p class="error">Failed to load approvals: ${error.message}</p>`;
        }
    }
}

// Function to approve/reject a budget
async function approveBudget(approvalId, isApproved) {
    try {
        const amountInput = document.getElementById(`approvedAmount-${approvalId}`);
        const notesInput = document.getElementById(`approvalNotes-${approvalId}`);
        
        const approvedAmount = isApproved ? parseFloat(amountInput.value) : 0;
        const approverNotes = notesInput.value;
        
        if (isApproved && (isNaN(approvedAmount) || approvedAmount <= 0)) {
            alert('Please enter a valid approved amount');
            return;
        }
        
        const response = await fetch(`https://man-m681.onrender.com/budget-approvals/${approvalId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                approved_amount: approvedAmount,
                approver_notes: approverNotes,
                status: isApproved ? 'approved' : 'rejected'
            })
        });
        
        if (!response.ok) throw new Error('Failed to update approval');
        
        alert(`Budget ${isApproved ? 'approved' : 'rejected'} successfully`);
        loadPendingApprovals(); // Refresh the list
        loadProgramCards(); // Update the balances
        
    } catch (error) {
        console.error('Error approving budget:', error);
        alert(`Failed to ${isApproved ? 'approve' : 'reject'} budget: ${error.message}`);
    }
}

// Function to check approval status for an activity
async function checkApprovalStatus(activityId) {
    try {
        const response = await fetch(`https://man-m681.onrender.com/budget-approvals/activity/${activityId}`);
        
        if (!response.ok) {
            if (response.status === 404) {
                return null; // No approval request exists
            }
            throw new Error('Failed to check approval status');
        }
        
        return await response.json();
    } catch (error) {
        console.error('Error checking approval status:', error);
        return null;
    }
}

// Update your existing manageActivityBudget function
async function manageActivityBudget(activityId, activityName) {
    // First check approval status
    const approval = await checkApprovalStatus(activityId);
    
    if (approval) {
        if (approval.status === 'pending') {
            alert(`Budget for "${activityName}" is pending approval by the Director`);
            return;
        } else if (approval.status === 'approved') {
            alert(`Budget for "${activityName}" has been approved (UGX ${approval.approved_amount.toLocaleString()})`);
            // Proceed to budget management
            showBudgetManagementModal(activityId, activityName);
            return;
        } else if (approval.status === 'rejected') {
            alert(`Budget for "${activityName}" was rejected. Notes: ${approval.approver_notes || 'None'}`);
            return;
        }
    }
    
    // If no approval exists, prompt to create one
    if (confirm(`Before managing the budget for "${activityName}", you need to submit it for Director approval. Proceed?`)) {
        await createBudgetApproval(activityId, activityName);
    }
}

    </script>
    <script src="sidebarToggle.js"></script>
    <script src="navNavigation.js"></script>
    <script src="roleNavigation.js"></script>
</body>
</html>
